function open_add_alert_modal(){if(!modal_shown){bootstrap.Modal.getOrCreateInstance($("#add_alert_modal_id")).show();modal_shown=true;}}
function close_add_alert_modal(){bootstrap.Modal.getOrCreateInstance($("#add_alert_modal_id")).hide();}
function trigger_auto_open_add_alert_modal(seconds_time){setTimeout(open_add_alert_modal,seconds_time);}
function trigger_open_add_alert_modal_events(){detect_leaving_intent(open_add_alert_modal);this.trigger_auto_open_add_alert_modal(1000*9);}
function check_trigger_open_add_alert_modal(is_authenticated){if((window.location.search.includes("save_alert=true"))&&is_authenticated){this.trigger_open_add_alert_modal_events();}}
function add_alert(){let save_query_btn=$("#save_query_btn")[0];saveQuery(save_query_btn);close_add_alert_modal();}
function open_upgrade_modal(){close_add_alert_modal();bootstrap.Modal.getOrCreateInstance($("#modal_free_account")).show();};var SEARCH_BTN_TEXT="SEARCH";let current_organizations=[];let should_reset_the_organizations_markers_in_map=false;$.ajaxSetup({cache:false});window.onpopstate=function(event){show_loading();location.reload()};$(function(){$('#search_module_link').addClass("selected");})
if(filter_values_json!==undefined&&filter_values_json['c']!==undefined){free_pass_code=filter_values_json['c'];}
$('#entities-list thead td').on("click",function(){col=$.trim($(this).find("span").text().toLowerCase());ga_eventa('click','search_organizations_sortBy_'+col);})
if(!is_premium&&!is_premium_plus){$("#entities-list_wrapper .row:last").hide()
$('#references-filter .news .filter-checkbox-label').addClass('is_premium');$('#references-filter .news').addClass('premium_dialog');$('#references-filter .web_monitoring .filter-checkbox-label').addClass('is_premium');$('#references-filter .web_monitoring').addClass('premium_dialog');$('#references-filter .patents .filter-checkbox-label').addClass('is_premium');$('#references-filter .patents').addClass('premium_dialog');$('#references-filter .trademarks .filter-checkbox-label').addClass('is_premium');$('#references-filter .trademarks').addClass('premium_dialog');$('#country-filter .filter-checkbox-label').addClass('is_premium');$('#funding-filter .filter-checkbox-label').addClass('is_premium');$('#investors-filter .filter-checkbox-label').addClass('is_premium');$('#country-filter #filter-content').addClass('premium_dialog');$('#funding-filter #filter-content').addClass('premium_dialog');$('#investors-filter #filter-content').addClass('premium_dialog');$('#add_country').addClass('is_premium');$('#add_country_div').addClass('premium_dialog');$('#grant-money-filter #filter-content #d-grant-money-f input').addClass('is_premium');$('#grant-money-filter #filter-content #d-grant-money-f').addClass('premium_dialog');$('#grant-money-filter #filter-content #d-grant-money-t input').addClass('is_premium');$('#grant-money-filter #filter-content #d-grant-money-t').addClass('premium_dialog');$('#grant-origin-filter .filter-checkbox-label').addClass('is_premium');$('#grant-origin-filter #filter-content').addClass('premium_dialog');$('#market-research-filter .filter-checkbox-label').addClass('is_premium');$('#market-research-filter #filter-content').addClass('premium_dialog');$('#time-filter #filter-content #visual-years-search').addClass('is_premium');$('#time-filter #filter-content #slider_wrap').addClass('is_premium');$('#time-filter #filter-content').addClass('premium_dialog');$('#entities-filter .filter-checkbox-label').addClass('is_premium');$('#entities-filter .org-type-entry').addClass('premium_dialog');}
$('.premium_dialog').on("click",function(event){bootstrap.Modal.getOrCreateInstance($('#modal_free_account')).show();});$(window).on('orientationchange',function(event){plot_filter(plot_data);});$(window).resize(function(){if($('html').width()>1024&&expanded_filter){expanded_filter=false;$('#search-filters').css({'display':""})
$('#search-left').css({'display':""})
$('#search-right').css({'display':""})
$('#dashboard-data-wrapper').css({'width':""})}});$('#GenerateReportModal').on('hidden.bs.modal',function(e){if(active_tab_before_report!==undefined){come_back_to_active_tab_before_report()}});$('#button_filter_expand, #button_filter_close').on("click",function(){expanded_filter=!expanded_filter;if(expanded_filter){$('#search-filters').show();$('#search-left').hide();$('#search-right').hide();$('#dashboard-data-wrapper').width('100%');plot_filter(plot_data);}else{$('#search-filters').css({'display':""});$('#search-left').css({'display':""});$('#search-right').css({'display':""});$('#dashboard-data-wrapper').css({'width':""})}});$(function(){$("[data-bs-toggle='tooltip']").tooltip();});function isempty(x){if(x!=="")
return true;}
function showTab(id){$('.search-right-block').hide();$('#search-right-'+id).show();if(id=='map'){$('#tab_foam').removeClass("activo");$('#tab_relationships').removeClass("activo");$('#tab_map_link').addClass("activo");}else if(id=='relationships'){$('#tab_foam').removeClass("activo");$('#tab_map_link').removeClass("activo");$('#tab_relationships').addClass("activo");}else{$('#tab_map_link').removeClass("activo");$('#tab_relationships').removeClass("activo");$('#tab_foam').addClass("activo");}}
function showDashboard(id){$('.dashboard-block').hide();$('#dashboard-'+id).show();if(id=='data'){$('#explore-view').removeClass("activo");$('#data-view').addClass("activo");}else{$('#data-view').removeClass("activo");$('#explore-view').addClass("activo");}}
function getFiltersHeight(){let filtersHeight=$("#search-filters").height()
const filterBtnPosition=$("#search-filters-cb").offset().top
if($(".tab-content")[0].scrollTop>filterBtnPosition)
filtersHeight+=$("#apply_filters_wrapper").height()
return filtersHeight}
function setSummaryTabsHeight(){$("#user_query_filters").height(Math.max($("#summary-info-height").height(),getFiltersHeight()))}
function setAnalyticsTabsHeight(){$("#user_query_filters").height(Math.max($("#dashboard-explore-height").height()+100,getFiltersHeight()+10))}
function setMapsTabsHeight(){$("#user_query_filters").height(Math.max($("#visualization-gmaps").height(),getFiltersHeight()+30))}
function setTableTabHeight(){$("#user_query_filters").height(Math.max($("#organisations-list").height()+15,getFiltersHeight()+10))}
function setFundedOrgsTabHeight(){$("#user_query_filters").height(Math.max($("#funded_orgs_list").height()+15,getFiltersHeight()+10))}
function setRefTabHeight(){check_show_more_button()
$("#user_query_filters").height(Math.max($("#references-list-block").height()+100,getFiltersHeight()+10))}
function showRefTab(){$('.results-left-block').hide();$('#references-list-block').show();}
function showSummaryTab(){setTimeout(function(){let p=$("#s_keyword_trends_id .portlet-body-s").height()-$("#summary_doc_type_pie_id .portlet-body-s").height();$("#summary_doc_type_pie_id .portlet-body-s").height($("#s_keyword_trends_id .portlet-body-s").height()+5)
$("#summary_doc_type_pie").css("padding-top",Math.trunc(p/2))},200)}
var synchronizeTableFiltersModule=(function(){var appliedFilters={};function isFilterApplied(filterAbr){if(appliedFilters[filterAbr]){return true;}
appliedFilters[filterAbr]='applied';return false;}
function removeFromAppliedSynchronizedFilters(filterAbr){delete appliedFilters[filterAbr];}
return{isFilterApplied:isFilterApplied,removeFromAppliedSynchronizedFilters:removeFromAppliedSynchronizedFilters}})();function synchronizeOrgTypeFilters(){let i;if(filter_values_json.org_type){const orgTypesList=Object.entries(org_types_by_graph_name_dict);filter_values_json.org_type.split(' ').forEach((orgTypeFilter)=>{i=0;while(i<orgTypesList.length&&orgTypesList[i][1].abbreviation!=orgTypeFilter){i+=1;};if(orgTypesList[i][1].abbreviation==orgTypeFilter&&!synchronizeTableFiltersModule.isFilterApplied(orgTypesList[i][1].abbreviation)){$($(".checkbox_filter_column_org_type[value='"+orgTypesList[i][0]+"']:checkbox:not(':checked')")[0]).trigger('click');}});}}
function showOrgTab(){$('.results-left-block').hide();$('#organisations-list').show();if($.fn.dataTable.isDataTable('#entities-list')){$('#entities-list').DataTable().draw();}
$('#entities-list').show();synchronizeOrgTypeFilters();}
function showFundedOrgsTab(){$('.results-left-block').hide();$('#funding_orgs_table').show();if($.fn.dataTable.isDataTable('#funded_orgs_list')){$('#funded_orgs_list').DataTable().draw();}
$('#funded_orgs_list').show();synchronizeOrgTypeFilters();}
function initTabSwappingObservers(){let orgs_list=$("#organisations-list");let funded_orgs_list=$("#funded_orgs_list");let records_list=$("#references-list-block");let mapTab=$("#visualization-gmaps");let analyticsTab=$("#dashboard-explore-height");onElementVisible("summary-info-height",function(){setSummaryTabsHeight();})
if(orgs_list[0]){onElementVisible("organisations-list",function(){setTableTabHeight();});}
if(funded_orgs_list[0]){onElementVisible("funded_orgs_list",function(){setFundedOrgsTabHeight();});}
if(records_list[0]){onElementVisible("references-list-block",function(){setRefTabHeight();})}
if(mapTab[0]){onElementVisible("visualization-gmaps",function(){setMapsTabsHeight();})}
if(analyticsTab[0]){onElementVisible("dashboard-explore-height",function(){setAnalyticsTabsHeight();})}}
function showInfo(elem){if($(elem.parentElement.parentElement.children[0]).hasClass("pub-info-expander")){$(elem.parentElement.parentElement.children[0]).removeClass("pub-info-expander");$(elem).children("span").removeClass("fa-angle-down")
$(elem).children("span").addClass("fa-angle-up")
$("#user_query_filters").height(Math.max($("#search-left").height(),$("#search-filters").height()+10))}else{$(elem.parentElement.parentElement.children[0]).addClass("pub-info-expander");$(elem).children("span").removeClass("fa-angle-up")
$(elem).children("span").addClass("fa-angle-down")
$("#user_query_filters").height(Math.max($("#search-left").height(),$("#search-filters").height()+10))}}
function set_up_filters(){$("#filter-boxes").empty();for(var key in filter_values_json){var attrName=key;if(attrName==="org_type"){const org_type_list=filter_values_json["org_type"].replace(/ /g,',').split(",");org_type_list.forEach((x,_i)=>$('#'+x+'-ent').prop('checked',true));}
if(attrName==="doc_type"){if(filter_values_json["doc_type"].indexOf("conf")>-1){$('#conf-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("pub")>-1){$('#pub-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("grant")>-1){$('#grant-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("pat")>-1){$('#pat-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("trad")>-1){$('#trad-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("new")>-1){$('#new-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("lkn")>-1){$('#lkn-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("ctrial")>-1){$('#ctrial-ref').prop('checked',true);}
if(filter_values_json["doc_type"].indexOf("tech")>-1){$('#tech-ref').prop('checked',true);}}
if(attrName==="yf"){yf=filter_values_json["yf"];yt=filter_values_json["yt"];filter_var="Year: "+yf+"-"+yt;}
if(attrName==="market_research"){if(filter_values_json['market_research']==="false"){$('#market_research_switch_input').prop('checked',true);}}
if(attrName==="grant_origin"){if(filter_values_json["grant_origin"].indexOf("american")>-1){$('#grant-us-ref').prop('checked',true);}
if(filter_values_json["grant_origin"].indexOf("european")>-1){$('#grant-eu-ref').prop('checked',true);}
if(filter_values_json["grant_origin"].indexOf("national")>-1){$('#grant-nat-ref').prop('checked',true);}}
if(attrName==="country"){if(filter_values_json['country']!==undefined){country_list=filter_values_json['country'].split(',')
for(i=0;i<country_list.length;i++){country_name=country_list[i]
country_rows=$("#country-type-row")}}}
if(attrName==="gmf"){gmf=filter_values_json["gmf"];gmt=filter_values_json["gmt"];$('#grant-money-f').val(gmf)
gmf=nFormatter(filter_values_json["gmf"],2)
if(gmt!=='above'){$('#grant-money-t').val(gmt)
gmt=nFormatter(filter_values_json["gmt"],2)}
filter_var="Grant Money: "+gmf+"-"+gmt;}
if(attrName==="geo"){if(g_maps_geo_info===undefined){g_maps_geo_info={"ne":{"lat":filter_values_json['geo']['ne']['lat'],"lon":filter_values_json['geo']['ne']['lon']},"sw":{"lat":filter_values_json['geo']['sw']['lat'],"lon":filter_values_json['geo']['sw']['lon']},"zoom":parseInt(filter_values_json['geo']['zoom']),"center":{"lat":filter_values_json['geo']['center']['lat'],"lon":filter_values_json['geo']['center']['lon']}}}
filter_var="Map";}
if(attrName==="sort_by"){if(filter_values_json["sort_by"].indexOf("date")>-1){$('#sort-by-date').prop('checked',true);}}}}
function set_up_table_filters(){let id_filter_table='filter-table-';let table_selector='#funded_orgs_list_wrapper table';for(const[filter_key,filter_values]of Object.entries(filter_values_json)){if(filter_key.includes(id_filter_table)){let attribute=filter_key.split(id_filter_table).slice(-1)[0];filter_values.split(',').forEach(function(single_value_filter){let input_selector=table_selector+' .filter-column-wrapper input['+attribute+'="'+single_value_filter+'"]';let e_inputs_selector=$(input_selector);if(e_inputs_selector.length!==0){let e_input_selector=$(e_inputs_selector[0]);change_page_url_when_filtering_table_columns=false;e_input_selector.click();change_page_url_when_filtering_table_columns=true;}});}}}
function get_tag_filter_graph(type,value,text,color){var div='<div id="'+value.replace(/ /g,"")+'" class="filter-graph-box" style="background: '+color+';" filter-type="'+type+'" filter-value="'+value+'" onclick="delete_tag_filter_graph_box(this);">'+'<div class="filter-graph-box-text">'+text+'</div>'+'<a href="javascript:;" class="btn btn-sm filter-graph-box-text-del-button">'+'<i class="fa fa-remove"></i>'+'</a>'+'</div>';return div;}
function fix_fullscreen_ipad(portlet){if(TEMPLATE_NAME==='search'){ga_eventa('click','search_dataAnalytics_expand');}else{ga_eventa('click','organizations_dataInsightsTab_filters_fullScreen');}
var is_iPad=navigator.userAgent.match(/iPad/i)!=null;if(is_iPad){var on=portlet.className.replace("fullscreen","").trim();var is_full_screen=on!=="on";if(is_full_screen){$('header').hide();$('.search-nav').hide();$('#data_insights_tab').css("overflow-y","hidden");$('#dashboard-explore').css("overflow-y","hidden");}else{$('header').show();$('.search-nav').show();$('#data_insights_tab').css("overflow-y","auto");$('#dashboard-explore').css("overflow-y","auto");}}}
function add_tag_filter_graph_box(type,value,text,color){var box_div=get_tag_filter_graph(type,value,text,color)
$("#"+type+"-filter-graph-boxes").append(box_div)}
function delete_tag_filter_graph_box(entry){var value=$(entry).attr('filter-value');var type=$(entry).attr('filter-type');$(entry).remove();$('#comparison_companies_kw_evolution svg[name="'+value+'"]').remove()
if(type==="kw"){remove_kw(value)}else{if(type==='aff'){remove_aff(value)}else{if(type==='industry'){remove_industry(value)}}}}
function removing_white_spaces(filter_string){filter_string=String(filter_string);return $.trim(filter_string.replace(/ +/g," "))}
function remove_commas(filter_string){filter_string=String(filter_string);return $.trim(filter_string.replace(/,$/g,"").replace(/^,/g,"")).replace(/,,/g,",")}
function cleaning_filter_string(filter_string){filter_string=String(filter_string);filter_string=filter_string.replace("++","");if(filter_string[filter_string.length-1]==='+'){filter_string=filter_string.slice(0,-1)}
if(filter_string[0]==='+'){filter_string=filter_string.slice(1,filter_string.length)}
return filter_string}
function cleaning_query_filter_string(filter_string){filter_string=String(filter_string)
filter_string=filter_string.replace(",,",",")
if(filter_string[filter_string.length-1]==','){filter_string=filter_string.slice(0,-1)}
if(filter_string[0]==','){filter_string=filter_string.slice(1,filter_string.length)}
return filter_string}
function add_sort_by_no_search(sort_by){ga_eventa('click','search_filters_sortByDate');if('sort_by'in filter_values_json){if(filter_values_json["sort_by"].indexOf(sort_by)<0){filter_values_json["sort_by"]=removing_white_spaces(filter_values_json["sort_by"]+' '+sort_by);}else{filter_values_json["sort_by"]=removing_white_spaces(filter_values_json["sort_by"].replace(sort_by,''));}}else{filter_values_json["sort_by"]=sort_by;}}
function add_entity_type_filter_no_search(org_type){ga_eventa('click','search_filters_orgType');if('org_type'in filter_values_json){if(filter_values_json["org_type"].indexOf(org_type)<0){filter_values_json["org_type"]=removing_white_spaces(filter_values_json["org_type"]+' '+org_type);}else{filter_values_json["org_type"]=removing_white_spaces(filter_values_json["org_type"].replace(org_type,''));if(filter_values_json["org_type"].length===0){delete filter_values_json["org_type"];}}}else{filter_values_json["org_type"]=org_type;}}
function add_reference_type_filter_no_search(doc_type){ga_eventa('click','search_filters_sourceType');if('doc_type'in filter_values_json){if(filter_values_json["doc_type"].indexOf(doc_type)<0){filter_values_json["doc_type"]=removing_white_spaces(filter_values_json["doc_type"]+' '+doc_type);}else{filter_values_json["doc_type"]=removing_white_spaces(filter_values_json["doc_type"].replace(doc_type,''));if(filter_values_json["doc_type"].length===0){delete filter_values_json["doc_type"];}}}else{filter_values_json["doc_type"]=doc_type;}}
function add_year_filter_no_search(year){ga_eventa('click','search_filters_timeFilter');if('year_filter'in filter_values_json){if(filter_values_json["year_filter"].indexOf(year)<0){filter_values_json["year_filter"]=removing_white_spaces(filter_values_json["year_filter"]+' '+year);}else{filter_values_json["year_filter"]=removing_white_spaces(filter_values_json["year_filter"].replace(year,''));}}else{filter_values_json["year_filter"]=year;}}
function add_country_filter_no_search(country_value){ga_eventa('click','search_filters_orgLocation');item_deleted=false;if('country'in filter_values_json){if(filter_values_json["country"].indexOf(country_value)<0){filter_values_json["country"]=cleaning_query_filter_string(cleaning_filter_string(removing_white_spaces(filter_values_json["country"]+','+country_value)));}else{filter_values_json["country"]=remove_commas(filter_values_json["country"].replace(country_value,''));item_deleted=true;if(filter_values_json["country"].length===0){delete filter_values_json["country"];}}}else{filter_values_json["country"]=country_value;}
return item_deleted;}
function check_funding_filter_modified(item_deleted_bool){if(item_deleted_bool){$("#add_funding_filter").show();$("#funding_filter_input").hide();}
return true}
function add_funding_filter_search(funding_scale_value){ga_eventa('click','search_filters_orgFunding');item_deleted=false;funding_scale_value=funding_scale_value.toString();if('funding'in filter_values_json){let funding_filter=filter_values_json["funding"];let funding_filter_list=funding_filter.split(',');if(funding_filter_list.indexOf(funding_scale_value.toString())<0){filter_values_json["funding"]=cleaning_query_filter_string(cleaning_filter_string(removing_white_spaces(filter_values_json["funding"]+','+funding_scale_value)));}else{filter_values_json["funding"]=remove_commas(filter_values_json["funding"].split(",").filter(item=>item!==funding_scale_value).join(","));item_deleted=true;if(filter_values_json["funding"].length===0){delete filter_values_json["funding"];}}}else{filter_values_json["funding"]=funding_scale_value;}
return item_deleted;}
function check_investors_filter_modified(item_deleted_bool){if(item_deleted_bool){$("#add_investor_filter").show();$("#investor_filter_input").hide();}
return true}
function add_investors_filter_search(investor_value){ga_eventa('click','search_filters_orgInvestors');let item_deleted=false;let investor_value_with_double_quotes='"'+investor_value+'"';if('investor'in filter_values_json){let investors_filter=filter_values_json["investor"];let investors_filter_list=investors_filter.split('","').map(element=>{return element.trim().trimRight('"').trimLeft('"');});if(investors_filter_list.indexOf(investor_value)<0){filter_values_json["investor"]=cleaning_query_filter_string(cleaning_filter_string(removing_white_spaces(filter_values_json["investor"]+','+investor_value_with_double_quotes)));}else{filter_values_json["investor"]=remove_commas(filter_values_json["investor"].split(",").filter(item=>item!==investor_value_with_double_quotes).join(","));item_deleted=true;if(filter_values_json["investor"].length===0){delete filter_values_json["investor"];}}}else{filter_values_json["investor"]=investor_value_with_double_quotes;}
return item_deleted;}
function add_market_research_filter(){if('market_research'in filter_values_json){delete filter_values_json["market_research"];}else{filter_values_json["market_research"]="false";}}
function add_grant_origin_filter_no_search(grant_type){ga_eventa('click','search_filters_grantLocation');if('grant_origin'in filter_values_json){if(filter_values_json["grant_origin"].indexOf(grant_type)<0){filter_values_json["grant_origin"]=removing_white_spaces(filter_values_json["grant_origin"]+' '+grant_type);}else{filter_values_json["grant_origin"]=removing_white_spaces(filter_values_json["grant_origin"].replace(grant_type,''));if(filter_values_json["grant_origin"].length===0){delete filter_values_json["grant_origin"];}}}else{filter_values_json["grant_origin"]=grant_type;}}
function add_doc_type_grant(){if('doc_type'in filter_values_json){if(filter_values_json["doc_type"].indexOf('grant')<0){filter_values_json["doc_type"]=removing_white_spaces(filter_values_json["doc_type"]+' '+'grant');}}else{filter_values_json["doc_type"]='grant';}}
function disable_filter_apply_btn(){if(!$("#apply-filters").hasClass("disabled")){$("#apply-filters").addClass("disabled")}}
function check_filter_modified(){if(_.isEqual(filter_values_json,filter_values_copy)){disable_filter_apply_btn()}else{$("#apply-filters").removeClass("disabled")}}
function check_country_filter_modified(item_deleted_bool,item_processed){if(item_deleted_bool){$("#add_country").show();$("#country_input").hide();}
return true}
function remove_search_term_filter_no_search(new_term,input_id){new_term=$.trim(new_term)
id=parseInt(input_id.split("-")[1])
list_id=id-1
temp_var=filter_values_json["query"][list_id].split(",")
temp_var.splice(temp_var.indexOf(new_term),1)
filter_values_json["query"][list_id]=cleaning_query_filter_string(removing_white_spaces(temp_var.join()))}
function removeKeywordFromFilterValues(inputId,elemPos){id=parseInt(inputId.split("-")[3])
listId=id-1
tempVar=filter_values_json["query"][listId].split(",");tempVar.splice(elemPos,1);filter_values_json["query"][listId]=cleaning_query_filter_string(removing_white_spaces(tempVar.join(',')));}
function add_search_term_filter_no_search(new_term,input_id,elemPos=undefined){new_term=$.trim(new_term)
if(!input_id){filter_values_json['query'].push(new_term);}else{id=parseInt(input_id.split("-")[3])
if(id<=filter_values_json['query'].length){list_id=id-1
if(elemPos!==undefined){temp_var=filter_values_json["query"][list_id].split(",");temp_var[elemPos]=new_term;filter_values_json["query"][list_id]=cleaning_query_filter_string(removing_white_spaces(temp_var.join(',')));}else{filter_values_json["query"][list_id]=cleaning_query_filter_string(removing_white_spaces(filter_values_json["query"][list_id]+','+new_term));}}else{filter_values_json['query'].push(new_term);}}}
function update_search_term_filter_no_search(new_term,old_term,input_id){let id=parseInt(input_id.split("-")[3]);let list_id=id-1;let const_comma_between_quotes='_#$#_';let quotes=filter_values_json["query"][list_id].match(/"(.*?)"/g);if(quotes!==null){for(let x=0;x<quotes.length;x++){let x_old=quotes[x];if(x_old.indexOf(",")>-1){let x_new=x_old.replace(",",const_comma_between_quotes);filter_values_json["query"][list_id]=filter_values_json["query"][list_id].replace(x_old,x_new);}}}
let temp_var=filter_values_json["query"][list_id].split(",")
for(let i=0;i<temp_var.length;++i){let i_temp_var=temp_var[i];i_temp_var=i_temp_var.replace(const_comma_between_quotes,',');if(i_temp_var===old_term){temp_var[i]=new_term}}
filter_values_json["query"][list_id]=cleaning_query_filter_string(removing_white_spaces(temp_var.join()));$('#'+input_id).find('input[data-bs-toggle="tooltip"]').each(function(){if($(this).attr('data-bs-original-title')===old_term){$(this).attr('value',new_term)
$(this).attr('data-bs-original-title',new_term)}});}
function remove_last_search_term_filter(id){list_id=id-1;if(list_id<filter_values_json['query'].length){filter_values_json['query'].splice(list_id,1);}}
function show_hide_filter_content(elem){let filter_name=$(elem);let filter_name_icon=filter_name.find(".show-hide-filter");let filter_name_premium_icon=filter_name.find(".premium");let filter_name_content=filter_name.parent().find("#filter-content");if(filter_name_content.is(":visible")){filter_name_content.hide();filter_name_icon.removeClass("fa-sort-up");filter_name_icon.addClass("fa-sort-down");filter_name_premium_icon.hide()}else{filter_name_content.show();filter_name_icon.removeClass("fa-sort-down");filter_name_icon.addClass("fa-sort-up");filter_name_premium_icon.show()}}
function check_show_more_button(){$('.pub-info-expander:visible').each(function(){let abstract=$(this);let btn=abstract.parent().find('.btn-overflow');let h=abstract[0].scrollHeight;if(h>56){btn.addClass('less');btn.css('display','block');}})}
function prepareAffiliationLink(a_tag){let ref=$(a_tag).attr('href');if(filter_values_json['yf']!==undefined){ref+='&yf='+filter_values_json['yf']}
if(filter_values_json['yt']!==undefined){ref+='&yt='+filter_values_json['yt']}
if(filter_values_json['doc_type']!==undefined){ref+='&doc_type='+filter_values_json['doc_type'].replace(/ /g,'+')}
$(a_tag).attr('href',ref);return true}
function come_back_to_active_tab_before_report(){if(active_tab_before_report!==undefined){active_tab_before_report.trigger('click');active_tab_before_report=undefined;}}
function showAnalyticsFromSummary(){$('.analytics-tab-ut')[0].click();scrollToTab();}
function showMapFromSummary(){$('.map-tab-ut')[0].click();scrollToTab();}
function generate_report(generate_report_url,data,is_in_house_report){$('.styled:checkbox').attr('disabled','disabled');let generate_report_modal_data_to_report=$("#generate_report_modal_data_to_report")[0];let kw_report=generate_report_modal_data_to_report.dataset.query;let affs_report=generate_report_modal_data_to_report.dataset.affsReport;let selected_affs=[];$('.styled:checkbox:checked').each(function(i,e){selected_affs.push({"id":$(this).attr("id"),"url":$(this).parent().parent().parent().find("input:last").val(),"name":$(this).parent().parent().find(".aff_name_report").text()})});let query_charts_data=JSON.parse(document.querySelector("#query_charts_data_id").dataset["chartsData"]);let time_evolution_plot_data=query_charts_data["time_evolution_chart"];let doc_type_pie_plot_data=query_charts_data["doc_type_pie_chart"];let entities_pie_plot_data=query_charts_data["entities_pie_chart"];let json={"kw":kw_report,"affs_report":affs_report,"selected_data":JSON.stringify(data),"query_info":JSON.stringify(filter_values_json),"time_evolution_plot_data":JSON.stringify(time_evolution_plot_data),"doc_type_pie_plot_data":JSON.stringify(doc_type_pie_plot_data),"entities_pie_plot_data":JSON.stringify(entities_pie_plot_data),"url":window.location.href,"is_in_house_report":JSON.stringify(is_in_house_report),};$.ajax({'url':generate_report_url,'type':"POST",'data':json,beforeSend:function(xhr,settings){xhr.setRequestHeader("X-CSRFToken",getCookie('csrftoken'));}});}
function showDocTabFromSummary(){$('.documents')[0].click();scrollToTop();}
function showOrgTabFromSummary(){$('.entities')[0].click();scrollToTop();}
function draw_social_graph(){if(collaboration_data===undefined){createSocialTable([]);}else{createSocialTable(collaboration_data.nodes);socialGraph(collaboration_data);}}
function showChartsHelpCaptions(){if(!help_captions_shown&&is_premium&&!is_bot){help_captions_shown=true;if(screen.width<=1125){$('span.caption-helper').hide()}}}
function load_export_url(pubs,news){$("#text_export_load_id").hide();$("#text_exporting_load_id").show();$('#download_query_btn').attr('onclick','').unbind('click');$('#download_query_btn').prop('onclick',null).off('click');function aux(){if(tables_relevant_kws_per_year!==undefined){let xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(xhttp.readyState===4){if(xhttp.status===200){let a=document.createElement('a');a.href=window.URL.createObjectURL(xhttp.response);let split=xhttp.responseURL.split('?');let params=split[1].split('&');let query=[];for(let x=0;x<params.length;x++){if((params[x].indexOf('q=')>=0)||(params[x].indexOf('q%5B%5D=')>=0)){params[x]=params[x].replace('q=','query=');params[x]=params[x].replace('q%5B%5D=','query%5B%5D=');}
if((params[x].indexOf('query=')>=0)||(params[x].indexOf('query%5B%5D=')>=0)){let term=params[x].replace('&','');term=term.replace('+',' ');term=term.replace('query=','');term=term.replace('query%5B%5D=','');query.push(term)}}
let name=query.length>0?query.join('&'):"results";a.download=name+".xlsx";a.style.display='none';document.body.appendChild(a);$("#text_export_load_id").show();$("#text_exporting_load_id").hide();return a.click();}else{$("#text_export_load_id").show();$("#text_exporting_load_id").hide();showErrorPleaseRetry();}}};xhttp.open("POST","/export/"+window.location.search+"&pubs_references="+pubs+"&news_references="+news,true);xhttp.setRequestHeader("Content-Type","application/json");xhttp.setRequestHeader("X-CSRFToken",getCookie('csrftoken'));xhttp.responseType='blob';xhttp.send(JSON.stringify({"tables":tables_relevant_kws_per_year}));}else{setTimeout(aux,2000);}}
aux();}
function add_event_report_url(){$(".report_url_i").focusout(function(){if($(this).val()!==""){if(validate_website($(this).val())){$(this).parent().parent().find(".styled:checkbox").removeAttr('disabled');$(this).css("border-color","");}else{$(this).css("border-color","red");}}else{$(this).parent().parent().find(".styled:checkbox").prop("checked",false);$(this).parent().parent().find(".styled:checkbox").attr('disabled','disabled');$(this).css("border-color","");$("#n_affs_report").text($('.styled:checkbox:checked').length);}})}
function company_for_report_selected(){$("#n_affs_report").text($('.styled:checkbox:checked').length);if($('.styled:checkbox:checked').length<20){$('.styled:checkbox').each(function(i,e){if($(this).parent().parent().parent().find("input:last").val()!==""){$(this).removeAttr('disabled')}});$("#n_affs_report_f").css("color","")}else{$('.styled:checkbox:not(:checked)').attr('disabled','disabled');$("#n_affs_report_f").css("color","red")}}
function sortEntitiesTable(){setTimeout(function(){$('#entities-list').DataTable().order([[1,'desc']]).draw()},300);}
function ajax_search(json,newTermInput,launchCall=true){json_copy=jQuery.extend(true,{},json);json_copy['ajax']='ajax_search';json_copy['search_session_id']=search_session_id;let page_url_query_parameters=build_url_query_parameters(json);if(page_url_query_parameters!==window.location.search){window.history.pushState({'path':page_url_query_parameters},'',page_url_query_parameters);$(window).on("popstate",function(){$.getScript(window.location.href);});}
if(launchCall){$('.summary')[0].click();show_loading_ajax_filters();help_captions_shown=false;$.ajax({'url':search_url,'type':"GET",'data':json_copy,success:function(data){var dummy_element=$('<dummy/>');dummy_element.html(data).contents();foamtree=undefined;map=undefined;reportModule.removeAllSelectedData();expanded_filter=!expanded_filter;$("#save_query_btn span").text($('#save_query_btn span',dummy_element).text());$("#save_query_btn").attr("onclick",$('#save_query_btn',dummy_element).attr('onclick'));$('#references-filter').html($('#references-filter',dummy_element));$('#entities-filter').html($('#entities-filter',dummy_element));$('#time-filter').html($('#time-filter',dummy_element));$('#country-filter').html($('#country-filter',dummy_element));$('#funding-filter').html($('#funding-filter',dummy_element));$('#investors-filter').html($('#investors-filter',dummy_element));$('#grant-money-filter').html($('#grant-money-filter',dummy_element));$('#grant-origin-filter').html($('#grant-origin-filter',dummy_element));$('#market-research-filter').html($('#market-research-filter',dummy_element));export_url=$('.button_tab #download_query_btn',dummy_element)[0].baseURI.replace('/search/','/export/');export_url=export_url+'&pubs_references='+total_pubs_references+'&news_references='+total_news_references;func="load_export_url('"+export_url+"')";document.getElementById('download_query_btn').setAttribute('onclick',func);var top_affs=JSON.parse($('#top_affs_compare',dummy_element).text());affiliation_ids=get_id_top_affs(top_affs);dashboard_data_showed=undefined;if($("#dashboard-data").is(":visible")){if($("#organisations-list").is(":visible")){dashboard_data_showed="org"}else{dashboard_data_showed="entities"}}
if($('#no-search-result-found').css('display')!=="none"){$("#user_query_filters").height($("#search-filters").height()+10);}
if(dashboard_data_showed!==undefined){if(dashboard_data_showed==='org'){showOrgTab();}else{showRefTab();}}
$('#results').html($('#results>*',dummy_element));$('#search-filters').css({'display':""});$('#search-left').css({'display':""});$('#search-right').css({'display':""});$('#map-top-tab').empty();$('#map-top-tab').html($('#map-top-tab>*',dummy_element));let funded_orgs_tab=$("#funded_orgs_tab");funded_orgs_tab.empty();funded_orgs_tab.html($('#funded_orgs_tab>*',dummy_element));$('#search_results_available').html($('#search_results_available',dummy_element));let search_results_available=$('#search_results_available')[0].innerText;if(search_results_available==="False"&&!$("#no-search-result-found").is(":visible")){$("#no-search-result-found").css("display","");$("#summary-info").css("display","none");$("#dashboard-data").css("display","none");funded_orgs_tab.css("display","none");$("#dashboard-explore").css("display","none");$("#map-top-tab").css("display","none");}
if(search_results_available==="True"&&$("#no-search-result-found").is(":visible")){$("#no-search-result-found").css("display","none");$("#summary-info").css("display","");$("#dashboard-data").css("display","");funded_orgs_tab.css("display","");$("#dashboard-explore").css("display","");$("#map-top-tab").css("display","");}
$('#summary_doc_type_pie_id').html($('#summary_doc_type_pie_id',dummy_element));$('#s_top_entities_id').html($('#s_top_entities_id',dummy_element));$('#s_top_ref_entities_id').html($('#s_top_ref_entities_id',dummy_element));$('#s_top_references_id').html($('#s_top_references_id',dummy_element));$('#topic_graph_id').html($('#topic_graph_id',dummy_element));$('#social_graph_id').html($('#social_graph_id',dummy_element));$('#table0_keywords_id').html($('#table0_keywords_id',dummy_element));$('#table1_keywords_id').html($('#table1_keywords_id',dummy_element));$('#institutions_ids_list_parsed').html($('#institutions_ids_list_parsed',dummy_element));$('#top_affs_compare').html($('#top_affs_compare',dummy_element));$("#matrix_chart_top_institutions_id").replaceWith($('#matrix_chart_top_institutions_id',dummy_element));$("#extra_charts_data_to_draw_id").replaceWith($('#extra_charts_data_to_draw_id',dummy_element));$("#query_charts_data_id").replaceWith($('#query_charts_data_id',dummy_element));$("#time_evolution_summary_chart").children().remove();dashboardModule.load_specific_evolution_chart("#time_evolution_summary_chart");$('#query-inputs-boxes input').blur();App.initAjax();dashboard_css_style=undefined;if(search_results_available==="True"){if(is_premium_plus){check_show_more_button();remove_loading();remove_loading_ajax_filters();disable_filter_apply_btn();if(!is_bot){dashboardModule.reload_dashboard_charts();}else{$("#organisations-list").show();}
filter_values_copy=jQuery.extend(true,{},filter_values_json);let extra_charts_observer=new MutationObserver(function(mutations,observer){let extra_charts_data_to_draw=JSON.parse(document.querySelector("#extra_charts_data_to_draw_id").dataset.extraChartsDataToDraw);extra_charts_data_to_draw.forEach(function(data){customChartMenuModule.clean_custom_chart_card(data["new_chart_id"]);});extra_charts_data_to_draw.forEach(function(data){customChartMenuModule.load_custom_chart(data["new_chart_id"],data["new_chart_data_to_draw"],data["new_chart_html"],data["new_chart_type"]);$("#"+data["new_chart_id"]+"_data_source").attr("data-chart-data-source",data["new_chart_data_source"]);});observer.disconnect();});let target=document.querySelector('#dashboard-explore');extra_charts_observer.observe(target,{attributes:true});}
if(!is_bot){load_table_org();init_fundings_table();}
if($("#dashboard-explore").is(":visible")){showChartsHelpCaptions();}}else{remove_loading();remove_loading_ajax_filters();}
$(function(){$("[data-bs-toggle='tooltip']").tooltip();});$('#GenerateReportModal .modal-body').html($('#GenerateReportModal .modal-body>*',dummy_element));add_event_report_url();event_handler_reset();set_up_filters();if(newTermInput){newTermInput.focus();newTermInput.click();}
$("#entities-list").DataTable().column(0).visible(false);},error:function(xhr,errmsg,err){console.log("InnoScout reload failed.");location.reload();}});}}
function iPadFix(){if($(document).width()===1025){$("#doc_type_pie").addClass('scroller')}}
function build_info_string(node){let result=''
if(node['Corporation']>0){result+='C:'+node['Corporation']+' '}
if(node['Small Company']>0){result+='SC:'+node['Small Company']+' '}
if(node['Research Institute']>0){result+='RI:'+node['Research Institute']+' '}
if(node['University']>0){result+='U:'+node['University']}
if(node['Startup']>0){result+='Startup:'+node['Startup']}
return result}
function check_org_type_value(value){if(value>0){return value}else{return'-'}}
function add_table_term_to_query(table_label){if($('.nav-tabs a[href="#dashboard-data"]:first').length!==0){$('.nav-tabs a[href="#dashboard-data"]:first').tab('show');showOrgTab();}else{$('.nav-tabs a[href="#dashboard_tab"]:first').tab('show');}
add_keywords_from_foam_tree(table_label,false);ga_eventa('click','search_dataAnalytics_relevantKeywords_keyword');}
function clear_legend_opacity(){$('.legendw:last rect').stop();$('.legendw:last text').stop();$('.legendw:last rect').animate({opacity:1},200);$('.legendw:last text').animate({opacity:1},200);}
function set_legend_opacity(legend_id){$('.legendw:last rect').stop();$('.legendw:last text').stop();$('.legendw:last rect').animate({opacity:0.1},100);$('.legendw:last rect:eq('+legend_id+')').stop();$('.legendw:last text').animate({opacity:0.1},100);$('.legendw:last text:eq('+legend_id+')').stop();$('.legendw:last rect:eq('+legend_id+')').animate({opacity:1},25);$('.legendw:last text:eq('+legend_id+')').animate({opacity:1},25);}
function clear_layer_opacity(){$('.layer').stop();$('.layer').animate({opacity:1},200);}
function set_layer_opacity(layer_id){$('.layer').stop();$('.layer').animate({opacity:0.2},100);$('.layer:eq('+layer_id+')').stop();$('.layer:eq('+layer_id+')').animate({opacity:1},25);}
function load_apply_filters_wrapper(){$("#apply_filters_wrapper").removeClass(fixed_css_class);let barpos=$('#apply_filters_wrapper').offset().top-$('#apply_filters_wrapper').outerHeight()-150;$('.tab-content').on('scroll',function(){if($(this).scrollTop()>=barpos&&!$("#apply_filters_wrapper").hasClass(fixed_css_class)){$("#apply_filters_wrapper").addClass(fixed_css_class);}
if($(this).scrollTop()<=barpos&&$("#apply_filters_wrapper").hasClass(fixed_css_class)){$("#apply_filters_wrapper").removeClass(fixed_css_class);}});}
function apply_filters_ajax_search(){removeEndAnimationEventListeners();const applyBtn=$(".search-btn")
applyBtn.text(SEARCH_BTN_TEXT);$("#add_country").show();$("#country_input").hide();disable_filter_apply_btn();ga_eventa('click','search_filters_applyFilters');ajax_search(filter_values_json);checkIfModifiedAndShowBtn();}
function filter_column_datatable(id_table,index_column,string_search){$(id_table).DataTable().columns(index_column).search(string_search,true,false).draw();}
function build_regex_string_based_on_filter_column(e_filter_table_column,attribute,text_wrapper){let checked_filters=e_filter_table_column.find("input:checked");let string_search_regex='('
let all_selected_filters=[];checked_filters.each(function(_i,e){let selected_single=e.getAttribute(attribute);if(all_selected_filters.indexOf(selected_single)===-1){all_selected_filters.push(selected_single);if(string_search_regex!=='(')string_search_regex+='|'
string_search_regex+="("+text_wrapper+selected_single+text_wrapper+")";}})
string_search_regex+=')';return string_search_regex==='()'?'':string_search_regex;}
function onchange_filter_table_column(e_checkbox,id_tables,index_column,attribute,selector_filter_wrapper,selector_filter_icon,text_wrapper){let class_filter_no_applied='no-applied';let selected_attribute_index_value=e_checkbox.getAttribute(attribute);let is_checked=e_checkbox.checked;id_tables.forEach(function(id_table,i){let e_table=$(id_table);let e_parent_table=e_table.parent().parent();let e_filter_table_column=e_parent_table.find(selector_filter_wrapper);if(e_filter_table_column.length!==0){let e_filter_icon=e_parent_table.find(selector_filter_icon);let e_original_checkbox=e_filter_table_column.find(' ['+attribute+'="'+selected_attribute_index_value+'"]');if(is_checked){e_original_checkbox.attr('checked','checked');}else{e_original_checkbox.attr('checked',null);}
e_original_checkbox[0].checked=is_checked;let string_search_regex=build_regex_string_based_on_filter_column(e_filter_table_column,attribute,text_wrapper);if(string_search_regex===""){e_filter_icon.addClass(class_filter_no_applied);}else{e_filter_icon.removeClass(class_filter_no_applied);}
filter_column_datatable(id_table,index_column,string_search_regex);should_reset_the_organizations_markers_in_map=true;}})
if(change_page_url_when_filtering_table_columns){add_table_column_filter_search(attribute,selected_attribute_index_value);}}
function add_table_column_filter_search(attribute,selected_attribute_index_value){let item_deleted=false;selected_attribute_index_value=selected_attribute_index_value.toString();let id_selector_filter_value="filter-table-"+attribute;if(id_selector_filter_value in filter_values_json){let current_value_filter=filter_values_json[id_selector_filter_value];let current_value_filter_list=current_value_filter.split(',');let index_selected_attribute_index_value=current_value_filter_list.indexOf(selected_attribute_index_value);if(index_selected_attribute_index_value<0){filter_values_json[id_selector_filter_value]=cleaning_query_filter_string(cleaning_filter_string(removing_white_spaces(filter_values_json[id_selector_filter_value]+','+selected_attribute_index_value)));}else{current_value_filter_list.splice(index_selected_attribute_index_value,1);filter_values_json[id_selector_filter_value]=current_value_filter_list.join(',');item_deleted=true;if(filter_values_json[id_selector_filter_value].length===0){delete filter_values_json[id_selector_filter_value];}}}else{filter_values_json[id_selector_filter_value]=selected_attribute_index_value;}
let page_url_query_parameters=build_url_query_parameters(filter_values_json);if(page_url_query_parameters!==window.location.search){window.history.pushState({'path':page_url_query_parameters},'',page_url_query_parameters);$(window).on("popstate",function(){$.getScript(window.location.href);});}
return item_deleted;}
function load_table_org(){if(is_bot)return;if(is_premium_plus){outherBarHeight=100;fixed_css_class='fixedbar';if(!is_on_trial){outherBarHeight=100;fixed_css_class='fixedbar-no-trial';}}
if(!is_premium){b_sort=false}
let id_table='#entities-list';let id_table_wrapper='#organisations-list';let table_org=$(id_table).DataTable({"drawCallback":function(){initialize_popovers(id_table_wrapper+" .filter-column-icon");initialize_tooltips();},"columnDefs":[{"orderSequence":["asc","desc"],"targets":[0]},{"orderSequence":["desc","asc"],"targets":"_all"}],"autoWidth":true,"bSort":b_sort,"order":[[2,'desc']],"oLanguage":{"sInfo":"Showing _START_ to _END_ of _TOTAL_ top organizations"},"pageLength":100,"lengthChange":false,"scrollX":true,"searching":true,"fixedColumns":{"left":2},});table_org.on('draw',function(){scrollToTab();initialize_popovers('.exclude-org-btn');initialize_tooltips();ga_eventa('click','search_organizations_pagination');});$(table_org).ready(function(){initialize_popovers('.exclude-org-btn');initialize_tooltips();});}
function load_user_tabs_event(){$('#user-tabs li').on('shown.bs.tab',function(e){scrollToTab();$($.fn.dataTable.tables(true)).DataTable().columns.adjust();});}
function set_query_filters_height(){$("#user_query_filters").height($("#user-tabs").height());}
$('#s_comparison_companies_kw_id .task-content').css('height',"100%").css('overflow','auto');function remove_loading_comparison_companies_kw(){$('#comparison_companies_kw_graph_spinner').hide();$('#comparison_companies_kw').show();}
function show_loading_comparison_companies_kw(){$('#comparison_companies_kw').hide();$('#comparison_companies_kw_graph_spinner').show();}
function ucfirst(str){var firstLetter=str.substr(0,1);return firstLetter.toUpperCase()+str.substr(1);}
show_loading_comparison_companies_kw();function create_date_summary_comparison_kws(data_affs){let data_affs_percentage=[];let aff_percentages;for(let aff_id in data_affs){if(data_affs.hasOwnProperty(aff_id)){aff_percentages={};for(let kw in data_affs[aff_id]){if(data_affs[aff_id].hasOwnProperty(kw)){aff_percentages[kw]={"n_docs":data_affs[aff_id][kw]['n_docs'],"size_circle":data_affs[aff_id][kw]['size']}}}
aff_percentages['aff']=info_affs[aff_id]['name'];aff_percentages['slug']=info_affs[aff_id]['slug'];aff_percentages['aff_id']=aff_id;data_affs_percentage.push(aff_percentages)}}
return data_affs_percentage}
function get_height(){return(topics_comparison.length+1)*70+80;}
function wrap(text,width){text.each(function(){let text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,y=text.attr("y"),x=text.attr("x"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",x).attr("y",y).attr("dy",dy+"em");while((word=words.pop())){line.push(word);tspan.text(line.join(" "));var textWidth=tspan.node().getComputedTextLength();if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",x).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word);}}});}
function resize_adjust(){let task_content=$('#trl_radar_chart_id .task-content')[0];if(task_content){let adjust_left=(task_content.clientWidth-415)/2;d3.select('#radarChart>svg').style('margin-left',adjust_left);}
$(".dataTables_scrollHeadInner").width($(".dataTables_scrollBody").width());}
window.addEventListener("orientationchange",resize_adjust,false);$(window).on("resize",resize_adjust);function set_social_search_table(){$("#social-search").keyup(function(){_this=this;ga_eventa('click','search_dataAnalytics_socialGraph_enterOrg');$.each($("#social_table tbody tr"),function(){if($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase())===-1)
$(this).hide();else
$(this).show();});});}
var style;var coral;var node_highligth_color;var node_color;function set_styles(){style=getComputedStyle(document.body);coral=style.getPropertyValue('--coral');node_highligth_color=coral;node_color="#000000";}
function trigger_must_wait_clicks(){onboardingUtilsModule.launch_request_demo_modal_on_every_click(['#visualization-foam-tree *'],['#login-id-a','#SignUp.modal *','#lkn_logo_home_id']);}
var social_node;var social_link;var simulation;var social_toggle=0;var social_drag=false;var social_table_click=false;var social_node_click=false;var social_linkedByIndex={};var social_width;var social_height;var social_node_radius;function load_social_graph(social_graph_url,org_ids,cb){var csrftoken=getCookie('csrftoken');$.ajax(social_graph_url,{type:'POST',headers:{"Content-Type":"application/json; charset=UTF-8","X-CSRFToken":csrftoken},data:JSON.stringify({data:filter_values_json,orgs_ids:org_ids})}).done(json=>{$('#social_graph_spinner').remove();$('#social_table_group').show();set_social_search_table();collaboration_data=json;collaboration_data_loaded=true;cb();});}
function createSocialTable(tableData){var table=document.createElement('table');var tableHeader=document.createElement('thead');var row=document.createElement('tr');var cell=document.createElement('th');cell.appendChild(document.createTextNode('Entities List'));cell.style.height="50px";cell.style.textAlign="center";row.appendChild(cell);tableHeader.appendChild(row);var tableBody=document.createElement('tbody');names_list=[]
for(i=0;i<tableData.length;i++){rowData=tableData[i]
names_list.push(rowData.id)}
names_list=names_list.sort();for(i=0;i<names_list.length;i++){var name=names_list[i]
var row=document.createElement('tr');var cell=document.createElement('td');cell.style.height="30px"
cell.appendChild(document.createTextNode(name));row.appendChild(cell);tableBody.appendChild(row);}
table.appendChild(tableHeader);table.appendChild(tableBody);$("#social_table").append(table);$("#social_table td").click(function(){highlights_from_table(this.textContent)});}
function socialGraph(graph){if(graph.nodes.length>110){social_height_val=1250}else{social_height_val=800}
social_width=1500;social_height=social_height_val;social_node_radius=20;if(TEMPLATE_NAME==='search'){simulation=d3.forceSimulation().force("collide",d3.forceCollide(function(d){return social_node_radius+4}).iterations(16)).force("link",d3.forceLink().id(function(d){return d.id;}).distance(100).strength(0.5)).force("charge",d3.forceManyBody().strength(10)).force("center",d3.forceCenter(social_width/2,social_height/2));}else{if(graph.nodes.length>110){social_height=900;}else{social_height=600;}
simulation=d3.forceSimulation().force("link",d3.forceLink().id(function(d){return d.id;}).distance(50).strength(0.8)).force("charge",d3.forceManyBody().strength(-150)).force("center",d3.forceCenter(social_width/2,social_height/2));}
svg=d3.select("#social_graph").append("svg").attr("width",social_width).attr("height",social_height).attr("class","scroll-svg");max_connections=d3.max(graph['links'],function(d){return(d.value);});min_connections=d3.min(graph['links'],function(d){return(d.value);});line_linear_scale=d3.scaleLinear().domain([1,max_connections]).range([2,5])
social_node_radius=35;social_link=svg.selectAll(".link").data(graph.links).enter().append("line").attr("class","social-link").attr('stroke-width',function(d){return line_linear_scale(d.value+1);}).on("mouseover",function(event,d){if(d.keywords.length===0){return false;}
d3.select(this).transition().duration(100).attr("width",140+2);let popover_options={'container':'body','placement':'auto','sanitize':false,'html':true,'title':d.value+' documents together','content':'<div id="sourrounding_div" style="width:100%;height:70px"> <canvas id="canvas_cloud"></canvas> </div>','trigger':'hover'};bootstrap.Popover.getOrCreateInstance(this,popover_options).show();var div=document.getElementById("sourrounding_div");var canvas=document.getElementById("canvas_cloud");canvas.height=div.offsetHeight*2;canvas.width=div.offsetWidth*2;canvas.style.width=div.offsetWidth+"px";canvas.style.height=div.offsetHeight+"px";options={list:d.keywords,rotateRatio:0,ellipticity:1,fontFamily:"'Open Sans', sans-serif",color:function(){return(['#1BBC9B','#3498DB','#FF6E69','#C44767','#fbbf6a'])[Math.floor(Math.random()*5)]}};WordCloud(document.getElementById('canvas_cloud'),options);}).on("mouseout",function(event,d){d3.select(this).transition().duration(100).attr("width",140);let element_popover=bootstrap.Popover.getInstance(this);if(element_popover){element_popover.dispose();}});social_node=svg.selectAll(".node").data(graph.nodes).enter().append("g").attr("class","social-node").on('click',connectedNodes).on("mouseover",mouseover_social).on("mouseout",mouseout_social).call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended));social_node.append("image").attr("xlink:href",function(d){return d.url}).attr("x",-8).attr("y",-8).attr("width",social_node_radius).attr("height",social_node_radius);simulation.nodes(graph.nodes).on("tick",ticked);simulation.force("link").links(graph.links);graph.links.forEach(function(d){social_linkedByIndex[d.source.index+","+d.target.index]=1;});for(i=0;i<graph.nodes.length;i++){social_linkedByIndex[i+","+i]=1;}
function ticked(){social_link.attr("x1",function(d){return d.source.x;}).attr("y1",function(d){return d.source.y;}).attr("x2",function(d){return d.target.x;}).attr("y2",function(d){return d.target.y;});social_node.attr("transform",function(d){return"translate("+Math.min(social_width-social_node_radius,d.x)+","+Math.min(social_height-social_node_radius,d.y)+")";});}
$("#social_graph_scoller").css("overflow-x","auto");}
function dragstarted(event,d){if(!d3.event.active)simulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;social_drag=true;}
function dragged(event,d){d.fx=d3.event.x;d.fy=d3.event.y;}
function dragended(event,d){if(!d3.event.active)simulation.alphaTarget(0);social_drag=false;}
function neighboring(a,b){return social_linkedByIndex[a.index+","+b.index];}
function connectedNodes(event,d){if(social_drag){social_drag=false;social_node_click=true;}else{highlight_node(d);social_node_click=true;}}
function highlight_node(d){social_node.select("text").remove();social_node.style("opacity",function(o){return neighboring(d,o)||neighboring(o,d)?1:0.04;});social_link.style("opacity",function(o){return d.index===o.source.index||d.index===o.target.index?1:0.02;});social_node.append("text").attr("dx",12).attr("dy",".35em").attr('font-family','sans-serif').style("font-size","14px").style("font-weight",400).text(function(o){return neighboring(d,o)|neighboring(o,d)?o.id:'';});social_node.style("fill",function(o){return neighboring(d,o)||neighboring(o,d)?node_highligth_color:node_color;});}
$('#social_graph').click(function(){if(social_drag||social_node_click){social_drag=false
social_node_click=false}else{social_table_click=false
social_node.style("opacity",1);social_node.style("fill",node_color);social_link.style("opacity",1);social_node.select("text").remove()}});function highlights_from_table(name){social_table_click=true
for(var i=0;i<collaboration_data.nodes.length;i++){if(name===collaboration_data.nodes[i].id){d=collaboration_data.nodes[i]
break}}
highlight_node(d)}
function mouseover_social(event,d){d3.select(this).transition().duration(100).attr("width",140+2);let popover_options={'container':'body','placement':'left','html':true,'title':'','content':d.id,'trigger':'hover'};bootstrap.Popover.getOrCreateInstance(this,popover_options).show();}
function mouseout_social(event,d){d3.select(this).transition().duration(100).attr("width",140);let element_popover=bootstrap.Popover.getInstance(this);if(element_popover){element_popover.dispose();}}
function set_disabled_popover_btns(disabled=true){let popover_btns=$("div.popover-body > div > button");if(typeof(btn_idx)==='number'){popover_btns[btn_idx].disabled=disabled;}else{for(let popover_btn of popover_btns){popover_btn.disabled=disabled;}}}
function set_popover_msg(new_msg){let popover_msg=$(".popover-header")[0];if(popover_msg){popover_msg.innerHTML=new_msg;}}
function set_exclude_org_timeout(){return setTimeout(function(){let cancel_btn=$("div.popover-body > div > button")[0];set_popover_msg("<i>This is taking too long...</i>");cancel_btn.innerHTML="Close";cancel_btn.disabled=false;},10000);}
function exclude_org_fail(){set_popover_msg("<i>There was an error. Try again?</i>");set_disabled_popover_btns(false);}
function exclude_org(org_id,org_slug,exclude_org_url){set_disabled_popover_btns(true);let timeout_handler=set_exclude_org_timeout();$.ajax({'url':exclude_org_url,'type':"POST",'data':{'org_id':org_id,'org_slug':org_slug},beforeSend:function(xhr,_){xhr.setRequestHeader("X-CSRFToken",getCookie('csrftoken'));}}).done(function(){let rows=$('tr[data-org-id='+org_id+']');let new_title='It will be restored. Are you sure?';rows.each(function(i,row){let a=$(row).find('.exclude-org-btn')[0];$(row).addClass('excluded-org-row');hide_popovers();a.setAttribute('popover-title',new_title);a.setAttribute('data-bs-original-title',new_title);a.setAttribute('aria-label',new_title);a.setAttribute('popover-onclick',`restore_org(${org_id}, '${org_slug}', restore_org_url)`);a.setAttribute('popover-accept','Yes, restore it!');});}).fail(exclude_org_fail).always(function(){clearTimeout(timeout_handler);});}
function restore_org(org_id,org_slug,restore_org_url){set_disabled_popover_btns(true);let timeout_handler=set_exclude_org_timeout();$.ajax({'url':restore_org_url,'type':"POST",'data':{'org_id':org_id,'org_slug':org_slug},beforeSend:function(xhr,_){xhr.setRequestHeader("X-CSRFToken",getCookie('csrftoken'));}}).done(function(){let rows=$('tr[data-org-id='+org_id+']');rows.each(function(i,row){let a=$(row).find('.exclude-org-btn')[0];$(row).removeClass('excluded-org-row');hide_popovers();a.setAttribute('popover-title',remove_result_popover_title);a.setAttribute('data-bs-original-title',remove_result_popover_title);a.setAttribute('aria-label',remove_result_popover_title);a.setAttribute('popover-onclick',`exclude_org(${org_id}, '${org_slug}', exclude_org_url)`);a.setAttribute('popover-accept',remove_result_popover_accept);});}).fail(exclude_org_fail).always(function(){clearTimeout(timeout_handler);});}
function init_fundings_table(){let fundings_table=$('#funded_orgs_list');let id_table_wrapper='#funded_orgs_list_wrapper';fundings_table.DataTable({"drawCallback":function(){initialize_popovers(id_table_wrapper+" .filter-column-icon");initialize_tooltips();},"order":[[2,'desc']],"columnDefs":[{"orderSequence":['desc','asc'],"targets":"_all"}],"autoWidth":true,"oLanguage":{"sInfo":"Showing _START_ to _END_ of _TOTAL_ top organizations"},"pageLength":100,"lengthChange":false,"scrollX":true,"searching":true,"fixedColumns":{"left":2}}).column(0).visible(false);;fundings_table.on('draw',function(){scrollToTab();initialize_popovers(id_table_wrapper+" .filter-column-icon");initialize_tooltips();});$('#entities-list').ready(function(){initialize_popovers(`${id_table_wrapper} .filter-column-icon`);initialize_tooltips();});set_up_table_filters();}
function export_experts_by_query_to_excel(endpoint_url){let query_url=window.location.href;show_loading_ajax_filters();$.ajax({url:endpoint_url,type:'GET',data:{'query':query_url},xhrFields:{responseType:'blob'},}).done(function(data,status,xhr){let blob=new Blob([data]);let link=document.createElement('a');link.href=window.URL.createObjectURL(blob);link.download=xhr.getResponseHeader('Export-Experts-Filename');link.click();}).always(remove_loading_ajax_filters);};"use strict;"
const DISABLED_CLASS="wrapper-button-row-invisible";const MODIFY_ALERT_BTN_SELECTOR="#modify_alert_btn";const ADD_ALERT_BTN_SELECTOR="#add_alert_btn";const DELETE_ALERT_BTN_SELECTOR="#delete_alert_btn";const BUTTON_WRAPPER_ID="alert_button_wrapper";const BUTTON_WRAPPER_SELECTOR="#"+BUTTON_WRAPPER_ID;const MANAGE_ALERT_BTN_SELECTOR="#manage_alert_btn";const SEPARATOR_SELECTOR=".button-sep";let manageAlertDataModule=function(){let alertName=undefined;let wasModified=false;let originalUrl=undefined;let node=undefined;let id=undefined
function getAlertName(){return alertName;};function setAlertName(name){alertName=name;}
function getWasModified(){return wasModified;}
function setWasModified(isModified){wasModified=isModified;}
function getOriginalUrl(){return originalUrl;}
function setOriginalUrl(url){originalUrl=url;}
function getNode(){return node;}
function setNode(newNode){node=newNode;}
function getId(){return id;}
function setId(newId){id=newId;}
return{getAlertName:getAlertName,setAlertName:setAlertName,getWasModified:getWasModified,setWasModified:setWasModified,getOriginalUrl:getOriginalUrl,setOriginalUrl:setOriginalUrl,getNode:getNode,setNode:setNode,getId:getId,setId:setId}}
const alertDataModule=manageAlertDataModule();function hideSeparators(){$(SEPARATOR_SELECTOR).addClass(DISABLED_CLASS);}
function showSeparators(){$(SEPARATOR_SELECTOR).removeClass(DISABLED_CLASS);}
function hideDeleteAlertBtn(){$(DELETE_ALERT_BTN_SELECTOR).addClass(DISABLED_CLASS);hideSeparators();}
function hideSaveAlertBtn(selector){$(selector).addClass(DISABLED_CLASS);}
function hideSaveButtons(){hideSaveAlertBtn(ADD_ALERT_BTN_SELECTOR);hideSaveAlertBtn(MODIFY_ALERT_BTN_SELECTOR);hideSeparators();}
function showBtn(selector){$(selector).removeClass(DISABLED_CLASS);}
function showSaveButtons(){showBtn(ADD_ALERT_BTN_SELECTOR);showBtn(MODIFY_ALERT_BTN_SELECTOR);showSeparators();}
function setUpAlertButtons(node_id,alert_name){const dropdownBtn=$(MANAGE_ALERT_BTN_SELECTOR);const dropdownMenu=$(BUTTON_WRAPPER_SELECTOR);dropdownMenu.hide();dropdownBtn.on("click",(event)=>onDropdownClick(event));let alertFromUrl=get_parameter_from_url("alert");if(alertFromUrl){hideSaveButtons();alertDataModule.setId(alertFromUrl);alertDataModule.setNode(node_id);alertDataModule.setAlertName(alert_name)}else{hideDeleteAlertBtn();hideSaveAlertBtn(MODIFY_ALERT_BTN_SELECTOR);}
alertDataModule.setOriginalUrl(window.location.href);$('#filter_references_block_id input.input-filter-check').on('click',()=>{checkIfModifiedAndShowBtn();});}
function placeDropdown(){const dropdownBtn=$(MANAGE_ALERT_BTN_SELECTOR);const btnPosition=dropdownBtn.position();const dropdownMenu=$(BUTTON_WRAPPER_SELECTOR);dropdownMenu.css({'top':(btnPosition.top+dropdownBtn.height()+14)+'px','left':(btnPosition.left+4)+'px'})}
function compareUrls(frstUrl,sndUrl){const paramName='alert';return remove_parameter_from_url(frstUrl,[paramName])!=remove_parameter_from_url(sndUrl,[paramName]);}
function checkIfModifiedAndShowBtn(){if(!alertDataModule.getNode())
return;if(alertDataModule.getOriginalUrl()&&compareUrls(window.location.href,alertDataModule.getOriginalUrl())){alertDataModule.setWasModified(true);showSaveButtons();}else{hideSaveAlertBtn(MODIFY_ALERT_BTN_SELECTOR);}}
function onDropdownClick(event){event.stopPropagation();placeDropdown();$(BUTTON_WRAPPER_SELECTOR).show();const dropdownBtn=$(MANAGE_ALERT_BTN_SELECTOR);dropdownBtn.off("click");$(document).on("click.close-dropdown",(event)=>{if($(event.target).closest(BUTTON_WRAPPER_SELECTOR).attr("id")!=BUTTON_WRAPPER_ID){onHideDropdownClick();}});}
function onHideDropdownClick(){$(BUTTON_WRAPPER_SELECTOR).hide();$(document).off("click.close-dropdown");const dropdownBtn=$(MANAGE_ALERT_BTN_SELECTOR);dropdownBtn.off("click");dropdownBtn.on("click",(event)=>onDropdownClick(event));}
function getNormalizedAlertName(){const alertName=alertDataModule.getAlertName();if(alertName===undefined)
return''
else
return alertName.replace('-',' ');}
function updateAlertData(data){alertDataModule.setId(data['alert_id']);alertDataModule.setAlertName(data['desc']);alertDataModule.setNode(data['query_id']);}
function onAddAlert(element){saveQuery(element,undefined,undefined,(data)=>{updateAlertData(data);commentGrowl("Alert added","my-info");onHideDropdownClick();hideSaveButtons();showBtn(DELETE_ALERT_BTN_SELECTOR);});}
function onSaveAlert(element){saveQuery(element,getNormalizedAlertName(),alertDataModule.getId(),(data)=>{updateAlertData(data);commentGrowl("Alert modified","my-info");onHideDropdownClick();hideSaveButtons();alertDataModule.setOriginalUrl(window.location.href);});}
function onDeleteAlert(element){deleteQuery(element,alertDataModule.getNode());commentGrowl("Alert removed","my-info");onHideDropdownClick();hideDeleteAlertBtn();hideSaveAlertBtn(MODIFY_ALERT_BTN_SELECTOR);showBtn(ADD_ALERT_BTN_SELECTOR);}
function adaptOrganizationLinks(){if(!getNormalizedAlertName())
return;$("#s_top_entities .media-body a").map((_,element)=>{$(element).attr("href",$(element).attr("href")+"&alert="+alertDataModule.getId())});$("tbody .entity_logo_name a.lkn-tx-corp").map((_,element)=>{$(element).attr("href",$(element).attr("href")+"&alert="+alertDataModule.getId())});};function initListTable(){listTable=$('#keyword_list_table').dataTable({dom:'l<"#table_toolbar">frtip',columnDefs:[{targets:0,bSortable:false,bSearchable:false,width:'1px'},{targets:2,bSearchable:false,bSortable:false,width:'18%'},],"searching":true,"bLengthChange":false,"bSort":true,"order":[[0,'asc']],initComplete:function(){$("div#table_toolbar").parent().prepend($("#datatable_buttons"))}});return listTable}
let listTable=undefined
function setListTable(){listTable=initListTable()}
function create_list(id,url){let name=$('#new_keyword_list_name').val().trim();const keywordInputs=$('.modal.kw.create-keyword-list .item_applied input:not(.search_complex_input)');let keywords="";if(keywordInputs.length)
keywords=$(keywordInputs).val().trim();if(keywordInputs.length>1)
for(let i=1;i<keywordInputs.length;i++){keywords+=" OR "+$(keywordInputs[i]).val().trim();}
if(!name){commentGrowl("List name must be provided",'my-error');return;}
show_loading_ajax_filters()
$.ajax({url:url,type:"POST",headers:{"X-CSRFToken":getCookie('csrftoken'),},data:{'name':name,'org_id':id,'keywords':keywords}}).done(function(msg){let new_row=$(msg.list_entry_html)
listTable.DataTable().row.add(new_row).draw()
$('#new_keyword_list_modal .items_applied_helper .search-complex-box').remove();$('#new_keyword_list_modal .items_applied_helper').append('<div id="wrapper-new-term" class="wrapper-new-term search-complex-box"></div>');setNewTerm('#new_keyword_list_modal #wrapper-new-term');$('#new-list-name').val(undefined)
bootstrap.Modal.getOrCreateInstance($('#new_keyword_list_modal')).hide()}).fail(function(_){showErrorPleaseRetry();}).always(()=>{remove_loading_ajax_filters()})}
function deleteList(listId,url){let tr=$('tr .remove-klist-button[data-keyword-list-id='+listId+']').closest("tr")
show_loading_ajax_filters()
$.ajax({url:url,type:"POST",headers:{"X-CSRFToken":getCookie('csrftoken'),},data:{"list_id":listId,}}).done(function(_){bootstrap.Modal.getOrCreateInstance(tr.find(".delete-keyword-list-modal")).hide()
listTable.fnDeleteRow(tr)}).fail(function(_){showErrorPleaseRetry();}).always(()=>{remove_loading_ajax_filters()})}
function getKeywordLists(){return(request,responseCallback)=>{$.ajax({'url':"/get-keyword-lists/",'type':"GET",headers:{"X-CSRFToken":getCookie('csrftoken'),},data:{query:request.term.substring(1)},success:function(data){responseCallback(data['data']);},error:function(xhr,errmsg,err){console.log("Error loading keyword lists.");commentGrowl("Something went wrong, try again later",'my-error');}})}};var digit_char_values=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,32]
var isFromSearchInputsFile=true;const NUMBER_OF_DIVIDER_ELEMENTS=3;let complexBoxDataModule=(function(){let lastDivId=1;let lastTermId=1;function raiseLastDivId(){lastDivId++;}
function getLastDivId(){return lastDivId;}
function decreaseLastDivId(){lastDivId--;}
function raiseLastTermId(){lastTermId++;}
function getLastTermId(){return lastTermId;}
function decreaseLastTermId(){lastTermId--;}
return{raiseLastDivId:raiseLastDivId,getLastDivId:getLastDivId,decreaseLastDivId:decreaseLastDivId,raiseLastTermId:raiseLastTermId,getLastTermId:getLastTermId,decreaseLastTermId:decreaseLastTermId}})();synonymsModule.initSettings("/get-kw-synonyms/","/get-kw-suggestion/","input.search-term",".search-complex-box:has(.new-term-input):not(#wrapper-new-term)",(input)=>{return $(".search-complex-box").index($(input).closest(".search-complex-box"))},()=>{return!($(document.body).hasClass("loading"))},)
function delete_using_cross(input){delete_search_term($(input.parentNode))}
function check_empty_kw_org(){let empty_kw=!filter_values_json['query']||filter_values_json['query'].length===0;let empty_org=!filter_values_json['organizations']||filter_values_json['organizations'].length===0;let empty_kw_org=empty_kw&&empty_org;if(empty_kw_org){show_loading();show_loading_ajax_filters();window.location.href=window.default_search_url;}
return empty_kw_org;}
function delete_search_term_no_ajax_search($input){$input=$($input);let $filters_input=$input.closest(".search-complex-box");let id=parseInt($filters_input.attr("id").split("-")[3])-1;if($filters_input.find(".item_applied.kw").length===1){synonymsModule.removeSynonymsForRow($filters_input.index());let num_filter_tags=$(".item_applied.kw").length;$filters_input.parent().remove();for(let i=id+1;i<=num_filter_tags;i++){$("#kw-ui-id-"+i+"-syn-block").attr("id","kw-ui-id-"+(i-1)+"-syn-block")}
complexBoxDataModule.decreaseLastDivId();for(let i=id;i<filter_values_json["query"].length;i++){if(filter_values_json["query"][i+1]){filter_values_json["query"][i]=filter_values_json["query"][i+1]}}
filter_values_json["query"]=filter_values_json["query"].splice(0,filter_values_json["query"].length-1)}else{const itemToRemove=$input.closest(".item_applied");removeOrItem(itemToRemove);let panel_query_terms=$filters_input.find('input.search-term').map((_,term_input)=>$(term_input).val()).filter((_,term_value)=>term_value.length>0).toArray();filter_values_json["query"][id]=cleaning_query_filter_string(removing_white_spaces(panel_query_terms.join(',')));}
synonymsModule.loadSynonyms($filters_input);if(!filter_values_json['query'])
delete filter_values_json['query'];return''}
function delete_search_term($input){delete_search_term_no_ajax_search($input);let isLoading=$($input).closest(".item_applied").hasClass("launching-search");var is_empty_kw_org=check_empty_kw_org();if(!(is_empty_kw_org||isLoading)){ajax_search(filter_values_json)}else if(!isLoading){show_loading();show_loading_ajax_filters();}
checkIfModifiedAndShowBtn();}
function get_filters_tagsinput_div(id){const placeholder="synonym";const divSize=placeholder.length+5;return'<div><div id="kw-ui-id-'+id+'-syn-block" class="search-complex-box"'+'</div>'+'<div id="kw-ui-id-'+id+'-syn" class="search_complex_input item_applied add-padding item_applied_synonym">'+'<div>'+'<input id="kw-ui-id-'+id+'-syn-input" size="'+divSize+'" class="new-term-input search_complex_input ui-autocomplete-input" placeholder="'+placeholder+'" data-id-kws-selected-synonym="kw-ui-id-'+id+'-syn" autocomplete="off">'+'</div>'+'</div></div>'}
function get_filters_tagsinput_div_with_and(send_ga){if(send_ga){if(TEMPLATE_NAME==='search'){ga_eventa('click','search_profileTab_addNewSearchTermAND_'+ga_user_type);}else{ga_eventa('click','organizations_profileTab_addNewSearchTermAND_'+ga_user_type);}}
const placeholder="filter keyword";const divSize=placeholder.length+5;return'<div id="wrapper-new-term" class="search-complex-box">'+'<div class="item-applied-wrapper">'+'<div class="search_complex_input add-padding item_applied item_applied_synonym">'+'<div>'+'<input id="new-term-input" size="'+divSize+'" class="new-term-input search_complex_input ui-autocomplete-input input_topic_autocomplete" placeholder="'+placeholder+'" autocomplete="off">'+'</div>'+'</div>'+'</div>'+'</div>'}
function modify_term(input,value){input=$(input);input.val(value);input.autocomplete('close');const item=input.closest(".search-complex-box");const id=item.attr('id').split('-')[3]-1
value=removeAmpersand(value);let pos=0;let inputIndex=0;item.find("input").each((_,elem)=>{if($(elem).val()==value)
inputIndex=pos;pos++;});let splited_terms=filter_values_json['query'][id].split(',');splited_terms[inputIndex]=value;filter_values_json['query'][id]=splited_terms.join(',');ajax_search(filter_values_json,input);}
function removeAmpersand(keyword){return keyword.replaceAll('&','and');}
function launchSearch(do_search,getSynonyms,divId,filter_values_json){if(do_search){let newInput=undefined;if(getSynonyms){synonymsModule.loadSynonyms($('#kw-ui-id-'+divId+'-syn-input').closest(".search-complex-box"));newInput=$('#kw-ui-id-'+divId+'-syn-input');}
ajax_search(filter_values_json,newInput);}
removeEndAnimationEventListeners();checkIfModifiedAndShowBtn();}
function removeEndAnimationEventListeners(){$(".launching-search").off("animationend").off("change").off("focusout").removeClass("animation-canceled").removeClass("launching-search");}
function resetApplyBtn(btn){btn.text(SEARCH_BTN_TEXT);btn.addClass("disabled");}
function onChangeValue(event,animationElement,input){let value=$(event.target).val();let elemSynId=$(event.target).closest(".item_applied")[0].id.split('-')[3];removeEndAnimationEventListeners();for(let i=0;i<NUMBER_OF_DIVIDER_ELEMENTS;i++)
animationElement.next().remove();const synKws=input.closest(".search-complex-box").find(".item_applied.kw");if(synKws.length==0){return;}
const elemPos=synKws.toArray().indexOf($(event.target).closest(".item_applied")[0]);const newTermInput=$(animationElement.closest(".search-complex-box").find(".new-term-input")[0]);if(value!==""){add_new_search_term_to_filter(newTermInput,value,true,true,true,elemSynId,elemPos);}else{removeKeywordFromFilterValues($(newTermInput).closest(".search-complex-box").attr('id'),elemPos);}
animationElement.remove();}
function removeAnimationIfNecessary(element){if(element.hasClass("launching-search")){element.off('animationend').removeClass("launching-search").addClass("animation-canceled");}}
function setAnimationEvents(termId,do_search,getSynonyms,divId,filter_values_json,input){const original_value=input.val();let applyBtn=$(".search-btn")
applyBtn.text(SEARCH_BTN_TEXT+" NOW");applyBtn.removeClass("disabled");removeEndAnimationEventListeners();let animationElement=$('#kw-ui-id-'+termId);animationElement.addClass("launching-search");animationElement.on('animationend',(event)=>{resetApplyBtn(applyBtn);launchSearch(do_search,getSynonyms,divId,filter_values_json);}).on("keydown",(_)=>{removeAnimationIfNecessary(animationElement);}).on("change",(event)=>{onChangeValue(event,animationElement,input);});$('input:not(#kw-ui-id-'+termId+')').on("keydown",()=>{removeAnimationIfNecessary(animationElement);});$("input.input-filter-check").on("click",()=>{removeAnimationIfNecessary(animationElement);})}
function add_new_search_term_to_filter($input,value,do_search,getSynonyms=true,showLaunchingAnimation=false,old_div_id=undefined,elemPos=undefined){if($input.hasClass("new-term-input"))
$input.autocomplete('close');value=removeAmpersand(value);add_search_term_filter_no_search(value,$input.closest(".search-complex-box").attr('id'),elemPos);let $filters_input=$input.parent().parent().parent();const newTermInput=$filters_input.find("#new-term-input")
let divId;const filter_id=$filters_input.attr('id')
if(filter_id)
divId=filter_id.split('-')[3];let newTermId;if(old_div_id!==undefined){newTermId=parseInt(old_div_id);}else{newTermId=complexBoxDataModule.getLastTermId();}
complexBoxDataModule.raiseLastTermId();if(newTermInput.length===1){divId=complexBoxDataModule.getLastDivId();complexBoxDataModule.raiseLastDivId();const $div=get_filters_tagsinput_div(divId).concat(get_and(true));newTermInput.closest(".search-complex-box").before($div);$("#kw-ui-id-"+divId+"-syn-block #kw-ui-id-"+divId+"-syn").before(get_search_term_div(value,newTermId,divId));event_handler_reset();}else{add_search_term($input,value,newTermId,divId,old_div_id);if(TEMPLATE_NAME=='search'){ga_eventa('click','search_profileTab_addNewSearchTermOR_'+ga_user_type);}else{ga_eventa('click','organizations_profileTab_addNewSearchTermOR_'+ga_user_type);}}
if(showLaunchingAnimation){setAnimationEvents(newTermId,do_search,getSynonyms,divId,filter_values_json,$input);}else{launchSearch(do_search,getSynonyms,divId,filter_values_json);resetApplyBtn($(".search-btn"));}}
function get_search_term_div(value,id,divId){const div_size=value.length
value=value.replace(/"/g,'&quot;');let add_tooltip=""
if(div_size>15){add_tooltip="data-bs-toggle=\"tooltip\" title=\""+value.toLowerCase()+"\" data-bs-container=\"body\" data-bs-placement=\"bottom\""}
let term_div='<div id="kw-ui-id-'+id+'" class="item_applied kw" data-term-class="kw" data-slug="'+value+'" data-id-kws-selected-synonym="kw-ui-id-'+divId+'-syn">'+'<div class="item-options-wrapper"><div class="item_text">'+'<input class="search-term" type="text" size="'+div_size+'" '+add_tooltip+' value="'+value+'" original_value="'+value+'" data-id-kws-selected-synonym="kw-ui-id-'+divId+'-syn">'+'</div>'+'<div class="item_options">'+'<i class="fas fa-times-circle" onclick="remove_kw_aff_complex_search(this, false)">'+'</i>'+'</div></div>'+'</div>';term_div+=get_line_syn()+get_or(true)+get_line_syn();return term_div;}
function add_search_term($next_input,new_value,new_id,last_div_id,old_div_id=undefined){new_value=$.trim(new_value);const $new_div=get_search_term_div(new_value,new_id,last_div_id);if(old_div_id){let $old_div=$("#kw-ui-id-"+old_div_id);$old_div.before($new_div);}else{$next_input.closest(".item_applied").before($new_div);}
event_handler_reset();if($new_div.indexOf('tooltip')>0){$("[data-bs-toggle='tooltip']").tooltip();}}
function type_here_input_keydown_event(){$(".item_applied").on('keydown','#new-term-input, .new-term-input',$.proxy(function(event){var $input=$(event.target);if(($.inArray(event.which,[8,46,37])>=0)&&($input.val().length===0)){$parent=$input.parent().parent()
$last_child=$parent.find(".search-term:last")
if($last_child.length==0){return;}
input_elem=$last_child.find(":input")
var strLength=input_elem.val().length*2;input_elem.focus();input_elem[0].setSelectionRange(strLength,strLength);return false;}
var do_search=false;if(event.which==13&&($input.val().length>0)){do_search=true;}
if(event.which==188&&$input.val().length==0){return false}
if((event.which==13&&$input.val().length>0)||(event.which==188&&$input.val().length>0)){add_new_search_term_to_filter($input,$input.val(),do_search,true,true);$input.val("")
if(!do_search){return false;}}},self));}
function type_here_input_focus_event(){$(".item_applied").on('focus','#new-term-input, .new-term-input',$.proxy(function(event){var $input=$(event.target);$parent=$input.parent().parent()
$last_child=$parent.find(".search-term:last")
if($last_child.length==0){return;}},self));}
function type_here_input_focusout_event(){$(".item_applied").on('focusout','input',$.proxy(function(event){var $input=$(event.target);$parent=$input.parent();$last_div=$parent.find("div:last");if($input.val()!==''&&$input.hasClass("new-term-input")){add_new_search_term_to_filter($input,$input.val(),true,true,true);$input.attr("placeholder","+ synonym");$input.attr("size","17");$input.val("");$parent.find(".or-separator:last").remove();return;}
if($last_div.length==0){return;}
if($last_div.hasClass("or-separator")){$last_div.remove()}},self));}
function type_here_input_events(){type_here_input_keydown_event();type_here_input_focus_event();type_here_input_focusout_event()}
function search_term_keydown_event(){$(".item_applied").on('keydown','.search-term',$.proxy(function(event){$('.tooltip').hide()
var $input=$(event.target);var textLength=$input.val().length
if($.inArray(event.which,[8,46])>=0){if(textLength==1||getSelectionText().length==textLength){if($input.parent().parent().find(".search-term").length==1){$input.parent().parent().find("#new-term-input").attr("placeholder","filter keyword");}
$input.val("")
delete_search_term($input.parent())
return false;}
textLength=textLength-1}else if(event.which==13){$input.focusout()}else if($.inArray(event.which,digit_char_values)>=0){textLength=textLength+1}
$input.attr('size',textLength);},self));}
function search_term_change_event(){$(".item_applied").on('change','.search-term',$.proxy(function(event){const item=$(event.target).closest(".item_applied");if(item.hasClass("launching-search")||item.hasClass("animation-canceled"))
return;var $input=$(event.target);const original_value=$input.attr("value");onChangeValue(event,item,$input,original_value,item.attr("id").split('-')[3]);},self));}
function setting_up_autocomplete(){const input_autocomplete=$(".new-term-input, .search-term");input_autocomplete.each((i,element)=>{element=$(element);element.autocomplete({source:(request,responseCallback)=>{if(request.term.startsWith(KEYWORD_SUBMENU_TOGGLE_KEY))
return getKeywordLists()(request,responseCallback);else
return synonymsModule.getAutocompleteSource(element)(request,responseCallback);},minLength:0,autoFocus:false,select:function(event,ui){synonymsModule.selectItem(event,ui,()=>{let input=$(event.target);if(ui.item.keywords){addListKeywords($(event.target),ui.item.keywords);}else if(input.hasClass("new-term-input")){add_new_search_term_to_filter(input,ui.item.value,true,true,true);input.val("");}else{modify_term(input,ui.item.value);}});return false;}}).off("click").on("click",function(){element.autocomplete("search");}).autocomplete("instance")._renderItem=function(ul,item){let $parent_div=$("<div>");$parent_div.addClass('auto-comp-parent input_block_suggester_helper');if(item.id){item.value=$(input_autocomplete[i]).val()+item.name;const submenuItem=$("<li class='keyword-submenu-item keyword-list-"+item['id']+"'>"+"<div class='list-header'><i class='fas fa-quote-left'></i><p class='keyword-submenu-list-name'>"+
item['name']+"</p></div>"+"<div class='keyword-list-batch'>Keyword List</div>"+"</li>");synonymsModule.addLoadingItemOrNormalItem(ul,item,$parent_div,()=>{$parent_div.append(submenuItem);});}else{synonymsModule.addLoadingItemOrNormalItem(ul,item,$parent_div,()=>{$parent_div.append('<i class="icon_item icon_topic fas fa-broadcast-tower"></i>');$parent_div.append('<div class="item_text">'+item.label+'</div>');$parent_div.append('<div class="tag_item tag_item_topic">Topic</div>');});}
return $parent_div.appendTo(ul);};});}
function change_url_window(){let page_url_query_parameters=build_url_query_parameters(filter_values_json);if(page_url_query_parameters!==window.location.search){window.history.pushState({'path':page_url_query_parameters},'',page_url_query_parameters);}}
function remove_org_applied_from_filter(slug,launchCall=true){let split_slug=slug.split('-');let aff_id=parseInt(split_slug[split_slug.length-1]).toString();let updated_orgs_filter=filter_values_json['organizations'][0].split(",").filter(e=>e!==aff_id).join(",");if(updated_orgs_filter)
filter_values_json['organizations']=[updated_orgs_filter]
else
delete filter_values_json['organizations'];let is_empty=check_empty_kw_org();if(!is_empty){ajax_search(filter_values_json,undefined,launchCall);}else{show_loading();show_loading_ajax_filters();}}
function add_new_search_org_to_filter(img,name,slug,reload){const new_org_id='aff-ui-id-'+slug;let existing_element=$('#'+new_org_id);if(existing_element.length===0){let new_org_div=$(getOrgItemApplied(name,slug,new_org_id,img));let input=$("#new-org-input")
input.attr('placeholder',"New Organization");let org_input=$('#wrapper-new-org');new_org_div.insertBefore(org_input)
let split_slug=slug.split('-');let aff_id=parseInt(split_slug[split_slug.length-1]);let organizations=[];if('organizations'in filter_values_json){organizations=filter_values_json['organizations'][0].split(",");organizations=organizations.map(x=>parseInt(x));}
let index_aff_id=organizations.indexOf(aff_id);if(index_aff_id===-1){organizations.push(aff_id);filter_values_json['organizations']=[organizations.join(",")];}
ajax_search(filter_values_json,undefined,reload);}else{$('#orgs-input-filter').val('');setTimeout(function(){duplicated_animate_item(new_org_id,'fadeIn');},300)}}
function duplicated_animate_item(element_id,animation){$('#'+element_id).removeClass(animation+' animated').addClass(animation+' animated').on('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){$(this).removeClass(animation+' animated');});}
function set_up_search_inputs_orgs(){for(let i=0;i<organizations_filtered_search.length;i++){let org=organizations_filtered_search[i];add_new_search_org_to_filter(org['picture'],org['name'],org['slug'],false)}}
function getSelectionText(){var text="";if(window.getSelection){text=window.getSelection().toString();}else if(document.selection&&document.selection.type!=="Control"){text=document.selection.createRange().text;}
return text;}
function search_term_events(){search_term_keydown_event();search_term_change_event()}
function event_handler_reset(){$(".item_applied").off();search_term_events();type_here_input_events();setting_up_autocomplete()}
function add_empty_search_filter(){let type_here_div_id=filter_values_json['query'].length+1;let div=get_filters_tagsinput_div("sf-"+type_here_div_id,false);$parent=$("#search-left-col");$parent.append(div)}
function set_up_search_inputs_terms(){let const_comma_between_quotes='_#$#_';let parent=$("#block_terms_applied .items_applied_helper");for(let i=0;i<filter_values_json['query'].length;i++){let search=filter_values_json['query'][i];const div_id=complexBoxDataModule.getLastDivId();complexBoxDataModule.raiseLastDivId();let div=get_filters_tagsinput_div(div_id).concat(get_and(true));parent.append(div);let quotes=search.match(/"(.*?)"/g);let search_terms=[];if(quotes!==null){for(let x=0;x<quotes.length;x++){let x_old=quotes[x];if(x_old.indexOf(",")>-1){let x_new=x_old.replace(",",const_comma_between_quotes);search=search.replace(x_old,x_new);}}}
var search_split=search.split(',');for(let x=0;x<search_split.length;x++){let x_search=search_split[x];if(x_search!==""){x_search=x_search.replace(const_comma_between_quotes,',');search_terms.push(x_search);}}
let type_here_input=parent.find("#kw-ui-id-"+div_id+"-syn-block #kw-ui-id-"+div_id+"-syn");for(let x=0;x<search_terms.length;x++){let term=search_terms[x];add_search_term(type_here_input,term,complexBoxDataModule.getLastTermId(),div_id);complexBoxDataModule.raiseLastTermId();}
type_here_input.parent().find('.or-separator:last').remove();type_here_input.attr("placeholder","synonym");type_here_input.attr("size","17");}
parent.append(get_filters_tagsinput_div_with_and(false))}
function set_up_search_inputs_entity(){set_up_search_inputs_terms();add_empty_search_filter();event_handler_reset();}
function set_up_search_inputs(setting_up_orgs=true){set_up_search_inputs_terms();add_empty_search_filter();event_handler_reset();if(setting_up_orgs){setting_up_organization_autocomplete();set_up_search_inputs_orgs();}}
function setting_up_organization_autocomplete(){var input_org=$("#new-org-input");input_org.autocomplete({source:"/get-aff-suggestion/",autoFocus:false,select:function(event,ui){if(ui.item.type!="org_request"){add_new_search_org_to_filter(ui.item.image,ui.item.label.replace("company: ",""),ui.item.slug,true);}else{showOrgRequestModal();}
input_org.val('');return false;},response:(_,ui)=>{if(ui.content.length!=0)
return
ui.content.push({'text':"Not here? Suggest us an organization",'type':"org_request"});}}).autocomplete("instance")._renderItem=function(ul,item){return setOrgAutocompleteRow(ul,item);};}
function add_keywords_from_foam_tree(new_keywords,showLaunchingAnimation=true){complexBoxDataModule.decreaseLastTermId();last_id=complexBoxDataModule.getLastTermId();if(TEMPLATE_NAME=='entity'&&last_id==0){add_empty_search_filter()
$("#search-left hr:first").show()
last_id=$(".item_applied").length}
let input=$("input#new-term-input");input.val(new_keywords);complexBoxDataModule.raiseLastTermId();add_new_search_term_to_filter(input,new_keywords,true,true,showLaunchingAnimation);input.val('');}"use strict";const KEYWORD_SUBMENU_TOGGLE_KEY='/';function show_preview_results_block(){$('#block_content_applied').addClass(class_previewing_results);$('#preview_results').addClass(class_previewing_results);$('section #top .container-fluid').addClass(class_previewing_results);$('.content_topic_block_complex').addClass(class_previewing_results);}
function dispatch_add_search_term_event(keyword,row_key){$("#block_search_complex")[0].dispatchEvent(new CustomEvent('addSearchTerm',{detail:{"keyword":keyword,"row_key":row_key,}}));}
function dispatch_remove_search_term_event(keyword){$("#block_search_complex")[0].dispatchEvent(new CustomEvent('removeSearchTerm',{detail:{"keyword":keyword,}}));}
function dispatch_edit_search_term_event(old_keyword,new_keyword,row_key){$("#block_search_complex")[0].dispatchEvent(new CustomEvent('editSearchTerm',{detail:{"old_keyword":old_keyword,"new_keyword":new_keyword,"row_key":row_key,}}));}
function get_and(smaller=false){if(smaller)
return'<div class="and-wrapper"><div class="link-line-and"></div><span class="and-divider divider-smaller-font">AND</span><div class="link-line-and"></div></div>'
else
return'<div class="and-wrapper"><div class="link-line-and"></div><span class="and-divider">AND</span><div class="link-line-and"></div></div>'}
function get_or(smaller=false){if(smaller)
return'<span class="or-divider divider-smaller-font">OR</span>'
else
return'<span class="or-divider">OR</span>'}
function get_org_link_line(){return'<div class="link-line-synonym link-org"></div>'}
function getOrgItemApplied(name,slug,new_org_id,img,fromInit=false){let link_aff_profile="/affiliation/"+slug;let add_tooltip=name.length>=26;let tooltip=add_tooltip?"data-bs-toggle=\"tooltip\" title=\""+name+"\" data-bs-placement=\"top\"":""
let div='<div id="'+new_org_id+'" class="item_applied" data-term-class="aff" data-slug="'+slug+'">'+'<div class="icon_item icon_aff" style="background-image: url('+img+')"></div>'+'<div class="item_text" '+tooltip+'><a target="_blank" href="'+link_aff_profile+'">'+name+'</a></div>'+'<div class="item_options">'+'<i class="fas fa-times-circle" onclick="remove_kw_aff_complex_search(this, '+fromInit+')"></i>'+'</div>'+'</div>'+get_org_link_line()+get_or(!fromInit)+get_org_link_line()
if(add_tooltip)$("[data-bs-toggle='tooltip']").tooltip();return div}
function check_placeholder_new_topic_input(){let and_text='filter keyword';let new_text='Type New Topic';let n_children=block_terms_applied.children().length-1;const wrapper=$('#wrapper-new-term input');if(wrapper.length===1){wrapper[0].placeholder=n_children===0?new_text:and_text;}}
function setting_up_autocomplete_search_complex(){setting_up_autocomplete_topic_all();setting_up_autocomplete_org();}
function setOrgAutocompleteRow(ul,item){let $parent_div=$('<div>');if(item.type=="org_request"){$parent_div.append("<div class='org-request-suggestion-row'>"+"<div class='display-org-suggestion-modal-icon'>"+"<i class='far fa-plus-square'></i>"+"</div>"+"<span>"+item.text+"</span>"+"</div>")}else{$parent_div.addClass('auto-comp-parent input_block_suggester_helper');$parent_div.append($("<img class='icon_item icon_aff'></img>").attr({src:item.image}));$parent_div.append("<div class=\"item_text\">"+item.label.replace("company: ","")+"</div>");$parent_div.append("<div class=\"tag_item tag_item_aff\">Org</div>");}
return $parent_div.appendTo(ul);}
function showOrgRequestModal(){const requestModal=$("#send_request_modal");const modals=$(".modal:not(#send_request_modal)");modals.map((_,el)=>{bootstrap.Modal.getOrCreateInstance($(el)).hide();});bootstrap.Modal.getOrCreateInstance(requestModal).show();requestModal.find(".request-phase").show();requestModal.find(".confirmation-phase").hide();}
function setting_up_autocomplete_org(){let input_org=$('#new-org-input');if(!input_org.length)
return
input_org.autocomplete({source:"/get-aff-suggestion/",autoFocus:false,select:function(event,ui){if(ui.item.type!="org_request"){let input=$(event.target);add_kw_aff_complex_search(ui.item['image'],ui.item['slug'],ui.item['value'],false,input);}else{showOrgRequestModal();}
input_org.val('');return false;},response:(_,ui)=>{if(ui.content.length!=0)
return
ui.content.push({'text':"Not here? Suggest us an organization",'type':"org_request"});}}).autocomplete("instance")._renderItem=function(ul,item){return setOrgAutocompleteRow(ul,item);};}
function setting_up_autocomplete_topic_all(){const input_autocomplete=$("input.input_topic_autocomplete");for(let i=0;i<input_autocomplete.length;i++){let input_i=$(input_autocomplete[i]);setting_up_autocomplete_topic(input_i,false);}}
function modifyKw(input,value){input=$(input);input.val(value);input.autocomplete('close');const box=input.closest(".search-complex-box");const id=input.attr("data-id-kws-selected-synonym");value=removeAmperson(value);let pos=0;let inputIndex=0;box.find("input").each((_,elem)=>{if($(elem).val()==value)
inputIndex=pos;pos++;});kws_selected_synonym[id][inputIndex]=value;adjust_width_input_content(input);input.attr('data-bs-original-title',value);$(box.find(".new-term-input")[0]).focus();complex_search_preview();synonymsModule.loadSynonyms(box);}
function addModifyEventListeners(input){input.off().on('keyup',(event)=>{if(event.key==='Enter'){modifyKw(input,input.val());}}).on('focusout',()=>{modifyKw(input,input.val());});}
function setting_up_autocomplete_topic(input_i,is_synonym){input_i.autocomplete({source:(request,responseCallback)=>{if(request.term.startsWith(KEYWORD_SUBMENU_TOGGLE_KEY))
return getKeywordLists()(request,responseCallback);else
return synonymsModule.getAutocompleteSource(input_i)(request,responseCallback);},minLength:0,autoFocus:false,select:function(event,ui){synonymsModule.selectItem(event,ui,()=>{if(ui.item.keywords){addListKeywords($(event.target),ui.item.keywords);}else{if(input_i.closest(".modal.kw").length){add_kw_aff_complex_search(undefined,undefined,ui.item['value'],is_synonym,$(event.target),true);input_i.val("");}else if(input_i.hasClass("search_complex_input")){add_kw_aff_complex_search(undefined,undefined,ui.item['value'],is_synonym,$(event.target));input_i.val("");}else
modifyKw(input_i,ui.item.value);}});return false;}}).on("focus",function(){input_i.autocomplete("search");}).autocomplete("instance")._renderItem=function(ul,item){let $parent_div=$("<div>");$parent_div.addClass('auto-comp-parent input_block_suggester_helper');if(item.id){item.value=input_i.val()+item.name;const submenuItem=$("<li class='keyword-submenu-item keyword-list-"+item['id']+"'>"+"<div class='list-header'><i class='fas fa-quote-left'></i><p class='keyword-submenu-list-name'>"+
item['name']+"</p></div>"+"<div class='keyword-list-batch'>Keyword List</div>"+"</li>");synonymsModule.addLoadingItemOrNormalItem(ul,item,$parent_div,()=>{$parent_div.append(submenuItem);});}else{synonymsModule.addLoadingItemOrNormalItem(ul,item,$parent_div,()=>{$parent_div.append('<i class="icon_item icon_topic fas fa-broadcast-tower"></i>');$parent_div.append('<div class="item_text">'+item.value+'</div>');$parent_div.append('<div class="tag_item tag_item_topic">Topic</div>');});}
return $parent_div.appendTo(ul);};if(input_i.hasClass("kw-term"))
return;input_i.on('keyup',function(e){if(e.keyCode===13){let input_value=input_i.val();input_value=input_value.trim();if(input_value){if(input_i.closest(".modal.kw").length)
add_kw_aff_complex_search(undefined,undefined,input_value,is_synonym,input_i,true);else
add_kw_aff_complex_search(undefined,undefined,input_value,is_synonym,input_i);}}});}
function slugify(text){return text.toString().toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-]+/g,'').replace(/\-\-+/g,'-').replace(/^-+/,'').replace(/-+$/,'');}
function slugify_kw(text){return slugify(text.replace(/"/g,'_').replace(/'/g,'_'))}
function check_kw_already_added(kw_text,id_kws_selected_synonym){var selected_array=kws_selected_synonym[id_kws_selected_synonym]||[];if(selected_array.includes(kw_text)){var text_slug=slugify_kw(kw_text);let aux=$("[data-id-kws-selected-synonym='"+id_kws_selected_synonym+"'][data-slug='"+text_slug+"']")
if(aux[0]){animate_item(aux[0].id,'flash');}
return false;}else{return true;}}
function check_item_added(is_aff,id_element,id_kws_selected_synonym){if(is_aff){if(block_search_complex_affs_selected.includes(id_element)){animate_item("aff-"+slugify(id_element),'flash');return false;}else{return true;}}else{return check_kw_already_added(id_element,id_kws_selected_synonym)}}
function mark_kws_selected(text){let kw_to_mark=slugify(text.replace(/"/g,'_').replace(/'/g,'_'));let class_kw_to_mark='kw_'+kw_to_mark;$('.'+class_kw_to_mark).addClass('disabled')}
function adjust_width_input_content(input){var inputWidth=$(input).textWidth()+10;$(input).css({width:inputWidth})}
function apply_filter(element,doc_type,preview){let query_info=build_complex_query();if(query_info!==undefined){if(preview)show_preview_results_block();let element_obj=$(element);let class_item_applied='item_applied';if(element_obj.hasClass(class_item_applied)){element_obj.removeClass(class_item_applied);const index_doc_type=block_search_complex_filters_selected.indexOf(doc_type);if(index_doc_type>-1)block_search_complex_filters_selected.splice(index_doc_type,1);}else{element_obj.addClass(class_item_applied);block_search_complex_filters_selected.push(doc_type);}
if(preview)complex_search_preview();}}
function add_event_input_keyword_no_enter(){$("#block_terms_applied .search_complex_input").focusout(function(e){let e_input=$(this);let value_input=e_input.val().trim();if(value_input!==""&&!value_input.startsWith(KEYWORD_SUBMENU_TOGGLE_KEY)&&e.key!=='ArrowDown'&&e.key!=='ArrowUp'){let is_synonym=e_input[0].id!=="new-term-input";if(e_input.closest(".modal.kw").length)
add_kw_aff_complex_search(undefined,undefined,value_input,is_synonym,e_input,true);else
add_kw_aff_complex_search(undefined,undefined,value_input,is_synonym,e_input);}else if(!value_input.startsWith(KEYWORD_SUBMENU_TOGGLE_KEY)&&e.key!=='ArrowDown'&&e.key!=='ArrowUp'){e_input.val("");}})}
function add_kw_aff_complex_search(aff_img,aff_slug,text,is_element_synonym,input,isManageKeywordsListView=false,isAutomatic=false,loadPreview=true,context_inputs='',add_typing_animation=false){let id_kws_selected_synonym=undefined;let closestNewTermWrapper=$(context_inputs+'#wrapper-new-term');if(input!==undefined){closestNewTermWrapper=input.closest("#wrapper-new-term");if(!isAutomatic){input.autocomplete('close');input.val('');}
id_kws_selected_synonym=input.data("id-kws-selected-synonym");}
let is_aff=aff_img!==undefined;let selected_block=is_aff?block_affs_applied:block_terms_applied;let $parent_div;let text_slug=slugify_kw(text);let text_item=is_aff?aff_slug:text.toLowerCase();let new_input_synonym=undefined;let new_term_box_id=undefined
if(check_item_added(is_aff,text_item,id_kws_selected_synonym)||isAutomatic){if(preview_option){show_preview_results_block();}
let id_content=$("<div>").uniqueId()[0].id;if(is_aff){new_term_box_id="aff-"+id_content;$parent_div=$(getOrgItemApplied(text,aff_slug,new_term_box_id,aff_img,true));block_search_complex_affs_selected.push(aff_slug);$(context_inputs+'#wrapper-new-org').before($parent_div);}else{new_term_box_id="kw-"+id_content;if(!is_element_synonym){id_kws_selected_synonym=new_term_box_id+"-syn";kws_selected_synonym[id_kws_selected_synonym]=[];$parent_div=$("<div> <div id='"+new_term_box_id+"-syn-block' class='search-complex-box'>"+
get_kw_box(new_term_box_id,text,id_kws_selected_synonym,text_slug,add_typing_animation)+
get_line_syn()+get_or()+get_line_syn()+"                        <div id='"+id_kws_selected_synonym+"' class=\"search_complex_input item_applied item_applied_synonym\">\n"+"                            <div><input id='"+new_term_box_id+"-syn-input' class='search_complex_input new-term-input' placeholder=\"synonym\" data-id-kws-selected-synonym='"+id_kws_selected_synonym+"'></div>\n"+"                        </div>"+"</div> </div>"+get_and());closestNewTermWrapper.before($parent_div);if(isManageKeywordsListView){const andBox=closestNewTermWrapper;andBox.prev().remove();andBox.remove();}}else{let id_input=input[0].id;let lastIndex=id_input.lastIndexOf("-input");id_kws_selected_synonym=id_input.substring(0,lastIndex);selected_block=$(context_inputs+"#"+id_kws_selected_synonym+"-block");let selected_block_children=selected_block.children();$parent_div=$(get_kw_box(new_term_box_id,text,id_kws_selected_synonym,text_slug,add_typing_animation)+get_line_syn()+get_or()+get_line_syn());$parent_div.insertBefore(selected_block_children[selected_block_children.length-1])}
if($parent_div){const newTermItem=$($parent_div).find("input.kw-term")[0];addModifyEventListeners($(newTermItem));setting_up_autocomplete_topic($(newTermItem),is_element_synonym);}
dispatch_add_search_term_event(text,id_kws_selected_synonym);adjust_width_input_content($parent_div.find('input')[0]);add_event_input_keyword_no_enter();if(kws_selected_synonym[id_kws_selected_synonym])
kws_selected_synonym[id_kws_selected_synonym].push(text_item);matching_kw_text_slug[text_slug]=text_item;}
if(!is_aff&&!is_element_synonym){new_input_synonym=selected_block.find("#"+new_term_box_id).next().next().next().next().find('input');setting_up_autocomplete_topic(new_input_synonym,true);}else{new_input_synonym=input;}
if(!is_aff){check_placeholder_new_topic_input();mark_kws_selected(text);}
if(!isAutomatic){synonymsModule.loadSynonyms($(`${context_inputs}#${id_kws_selected_synonym}`).parent());$(context_inputs+"#"+new_term_box_id+"-syn-input").focus();}
if(preview_option&&loadPreview)complex_search_preview();}
return[new_input_synonym,new_term_box_id];}
function is_not_array_empty(el){return Array.isArray(el)&&el.length}
function create_query_terms(){let query=[];let kws;for(let key in kws_selected_synonym){if(kws_selected_synonym.hasOwnProperty(key)&&kws_selected_synonym[key].length>0){kws=removeAmperson(kws_selected_synonym[key].join(','));query.push(kws)}}
return query}
function build_complex_query(){info_complex_search.text('');let organizations=[];let result=undefined;block_search_complex_affs_selected.forEach(function(value,i){let field_split=value.split('-');let aff_id=field_split[field_split.length-1];if(!organizations.includes(aff_id))organizations.push(aff_id);});let json_value={};var query_terms=create_query_terms();if(is_not_array_empty(query_terms)){json_value['query']=query_terms;}
if(is_not_array_empty(organizations))json_value['organizations']=organizations.join(",");let page_url_query_parameters=build_url_query_parameters(json_value);if(page_url_query_parameters===""){info_complex_search.text('Search for any topic or organization.');return result;}
if(is_not_array_empty(block_search_complex_filters_selected))json_value['doc_type']=block_search_complex_filters_selected.join(' ');let name_alert_search_complex_input=$('#name_alert_search_complex_input');if(name_alert_search_complex_input.length!==0){let value=name_alert_search_complex_input.val();value=value.trim();if(value){json_value['name_query']=value.replace(/&/g,'__$__');}}
let page_url;if(block_search_complex_affs_selected.length===1){json_value['slug']=block_search_complex_affs_selected[0];page_url=build_url("affiliation",json_value,true,block_search_complex_affs_selected[0]);}else{page_url=build_url("search",json_value,false);}
result={"pageurl":page_url,"json_value":json_value};return page_url_query_parameters===""?undefined:result;}
function show_preview_search_loading(){$('#preview_results .preview_wrapper').css('opacity','0.4');$("#preview_search_loader").show();}
function remove_preview_search_loading(){$('#preview_results .preview_wrapper').css('opacity','1');$("#preview_search_loader").hide();}
function do_preview_search(json_value,f_call){$.ajax({url:'/preview/',type:"GET",data:json_value,contentType:"application/json",success:function(data){var dummy_element=$('<dummy/>');dummy_element.html(data).contents();$("#preview_results").html(($('#preview_results>*',dummy_element)));f_call(true);},error:function(xhr,errmsg,err){console.log(errmsg);console.log(err);}});}
function complex_search_preview(){$('#preview_results').fadeIn();show_preview_results_block();show_preview_search_loading();let query_info=build_complex_query();if(query_info!==undefined){let json_value=query_info['json_value'];do_preview_search(json_value,function(success){if(success){$("[data-bs-toggle='tooltip']").tooltip();remove_preview_search_loading();setTimeout(function(){animate_item('preview_results_n_matching_records','flash');},1000);}})}else{remove_preview_search_loading();clean_complex_init_search();}}
function complex_search_search(){show_loading();show_loading_ajax_filters();let query_info=build_complex_query();if(query_info!==undefined){window.location.href=query_info['pageurl'];}else{remove_loading();remove_loading_ajax_filters();}}
function complex_search_create_alert(alert_id,parent_id,suggestion_id=null){let query_info=build_complex_query();if(query_info!==undefined){let json_value=query_info['json_value'];json_value['url']=query_info['pageurl'];if(alert_id){json_value['alert_id']=alert_id;}
if(parent_id){json_value['parent_folder_id']=parent_id;}
if(suggestion_id){json_value['user_suggestion_id']=suggestion_id}
clean_complex_init_search('#complexAlertModal');save_feed_query_ajax_call(undefined,json_value,false);}}
function remove_mark_kws_selected(text){let kw_to_mark=slugify(text.replace(/"/g,'_').replace(/'/g,'_'));let class_kw_to_mark='kw_'+kw_to_mark;$('.'+class_kw_to_mark).removeClass('disabled')}
function removeIfEmpty(kws,synonymId,container){if(kws[synonymId].length===0){const helper=container.closest('.items_applied_helper');let isManageKeywordsListView=false
if(container.closest(".modal.kw").length)
isManageKeywordsListView=true
container.next().remove();container.remove();if(isManageKeywordsListView){helper.append('<div id="wrapper-new-term" class="specific-new-wrapper search-complex-box"></div>');setNewTerm("#wrapper-new-term.specific-new-wrapper");helper.find(".specific-new-wrapper").removeClass("specific-new-wrapper");setting_up_autocomplete_search_complex();add_event_input_keyword_no_enter();}}}
function removeOrItem(itemToRemove){itemToRemove=$(itemToRemove);for(let i=0;i<3;i++){itemToRemove.next().remove();}
itemToRemove.remove();}
function remove_kw_aff_complex_search(caller,fromInit=true,launchCall=true){let item_to_delete=$(caller).closest("[data-term-class]")
let is_aff=item_to_delete.data("term-class")==="aff"
let slug=item_to_delete.data("slug")
let id_kw_synonym=item_to_delete.data("id-kws-selected-synonym")
var absolute_parent=item_to_delete.parent().parent();let id_element=(fromInit&&!is_aff)?matching_kw_text_slug[slug]:slug;if(fromInit&&is_aff){var index_kw=block_search_complex_affs_selected.indexOf(id_element);block_search_complex_affs_selected.splice(index_kw,1);}
if(!is_aff){if(!fromInit){delete_search_term(caller);}else{remove_mark_kws_selected(id_element);check_placeholder_new_topic_input();}}else if(!fromInit)
remove_org_applied_from_filter(slug,launchCall);removeOrItem(item_to_delete);if(!fromInit&&absolute_parent.find(".item_applied").length===1&&absolute_parent.find("#new-org-input").length===0){absolute_parent.remove();}
if(fromInit&&id_kw_synonym){let kws=kws_selected_synonym[id_kw_synonym];index_kw=kws.indexOf(id_element);kws_selected_synonym[id_kw_synonym].splice(index_kw,1);synonymsModule.loadSynonyms(absolute_parent);removeIfEmpty(kws_selected_synonym,id_kw_synonym,absolute_parent);}
if(preview_option)complex_search_preview();if(fromInit){dispatch_remove_search_term_event(id_element);}}
function get_line_syn(){return"<div class=\"link-line-synonym\"></div>"}
function get_kw_box(box_id,text,id_kws_selected_synonym,text_slug,add_typing_animation=false){const div_size=text.length
let add_tooltip=""
let typing_animation_class_text='';const value=text.replace(/"/g,'&quot;');if(add_typing_animation){typing_animation_class_text='typed-out'}
if(div_size>10){add_tooltip="data-bs-toggle=\"tooltip\" title=\""+value.toLowerCase()+"\" data-bs-container=\"body\" data-bs-placement=\"bottom\""}
return"<div id='"+box_id+"' class='item_applied' data-term-class='kw' data-slug='"+text_slug+"' data-id-kws-selected-synonym='"+id_kws_selected_synonym+"'>"+"       <div class='item-options-wrapper'><div class='item_text'><input class='kw-term "+typing_animation_class_text+"' type='text' "+add_tooltip+"value='"+text+"' original_value='"+text+"' data-id-kws-selected-synonym='"+id_kws_selected_synonym+"'></div>"+"               <div class=\"item_options\">\n"+"                     <i class=\"fas fa-times-circle\" onclick=\"remove_kw_aff_complex_search(this)\"></i>\n"+"               </div></div>"+"</div>"}
function setNewTerm(selector="#wrapper-new-term"){const placeholder="Type New Topic";const div='<div class="item-applied-wrapper">'+'<div class="search_complex_input item_applied item_applied_synonym">'+'<div>'+'<input id="new-term-input" class="search_complex_input ui-autocomplete-input input_topic_autocomplete" placeholder="'+placeholder+'" autocomplete="off">'+'</div>'+'</div>'+'</div>';$(selector).append(div);}
function removeAmperson(keyword){return keyword.replaceAll('&','and');}
function addListKeywords(input,kw){input.val("");const keywords=kw.split(' OR ');for(let i=0;i<keywords.length;i++){const keyword=keywords[i];if(typeof isFromSearchInputsFile!=='undefined'){let doSearch=false;if(i===keywords.length-1)
doSearch=true;add_new_search_term_to_filter(input,keyword,doSearch,doSearch);}else{let isSynomym=true;if(input.attr('id')==='new-term-input'&&i===0)
isSynomym=false;let loadPreview=false;if(i===keywords.length-1)
loadPreview=true;add_kw_aff_complex_search(undefined,undefined,keyword,isSynomym,input,false,true,loadPreview);}
if(input.attr('id')==="new-term-input"){input=$(input.closest(".search-complex-box").prevAll("div:has(.search-complex-box)")[0]).find(".search_complex_input input");}}}
const delay=async(ms)=>new Promise(resolve=>setTimeout(resolve,ms));async function add_kws_to_search_input(kws_selected,context_inputs='',load_preview_only_at_the_end=false,add_typing_animation=false){let _=undefined;let input_i=undefined;let is_synonym=false;let isAutomatic=true;let kws_list=undefined;let loadPreview=true;let sleep_between_kws_ms=1500;let kws=undefined;let kw=undefined;let index_and=undefined;let index_or=undefined;let current_preview_option=preview_option;let is_last_step=false;if(load_preview_only_at_the_end){loadPreview=false;preview_option=false;}
for(index_and=0;index_and<kws_selected.length;index_and++){kws=kws_selected[index_and];input_i=undefined;is_synonym=false;kws_list=kws.split(',');for(index_or=0;index_or<kws_list.length;index_or++){kw=kws_list[index_or];isAutomatic=true;if(index_or===kws_list.length-1){isAutomatic=false;if(index_and===kws_selected.length-1){is_last_step=true;if(load_preview_only_at_the_end){preview_option=current_preview_option;loadPreview=true;}}}
kw=kw.trim();[input_i,_]=add_kw_aff_complex_search(undefined,undefined,kw,is_synonym,input_i,false,isAutomatic,loadPreview,context_inputs,add_typing_animation);is_synonym=true;if(add_typing_animation&&!is_last_step){await delay(sleep_between_kws_ms);}}}};/*!
 * Intro.js v7.0.1
 * https://introjs.com
 *
 * Copyright (C) 2012-2023 Afshin Mehrabani (@afshinmeh).
 * https://introjs.com
 *
 * Date: Sat, 25 Mar 2023 14:24:34 GMT
 */!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).introJs=e()}(this,(function(){"use strict";function t(){t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof f?e:f,a=Object.create(o.prototype),s=new j(r||[]);return i(a,"_invoke",{value:x(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var p={};function f(){}function d(){}function m(){}var b={};c(b,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(A([])));y&&y!==n&&r.call(y,a)&&(b=y);var g=m.prototype=f.prototype=Object.create(b);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function n(i,o,a,s){var l=h(t[i],t,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(l.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function x(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return E()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=k(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=h(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function k(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=h(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function A(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return d.prototype=m,i(g,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:d,configurable:!0}),d.displayName=c(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new _(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,l,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e,n,r,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,i)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function s(t){n(a,i,o,s,l,"next",t)}function l(t){n(a,i,o,s,l,"throw",t)}s(void 0)}))}}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var l,c=(l={},function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"introjs-stamp";return l[e]=l[e]||0,void 0===t[e]&&(t[e]=l[e]++),t[e]});function u(t,e,n){if(t)for(var r=0,i=t.length;r<i;r++)e(t[r],r);"function"==typeof n&&n()}var h=new function(){var t="introjs_event";this._id=function(t,e,n){return t+c(e)+(n?"_".concat(c(n)):"")},this.on=function(e,n,r,i,o){var a=this._id.apply(this,[n,r,i]),s=function(t){return r.call(i||e,t||window.event)};"addEventListener"in e?e.addEventListener(n,s,o):"attachEvent"in e&&e.attachEvent("on".concat(n),s),e[t]=e[t]||{},e[t][a]=s},this.off=function(e,n,r,i,o){var a=this._id.apply(this,[n,r,i]),s=e[t]&&e[t][a];s&&("removeEventListener"in e?e.removeEventListener(n,s,o):"detachEvent"in e&&e.detachEvent("on".concat(n),s),e[t][a]=null)}};function p(t,e){if(t instanceof SVGElement){var n=t.getAttribute("class")||"";n.match(e)||t.setAttribute("class","".concat(n," ").concat(e))}else{if(void 0!==t.classList)u(e.split(" "),(function(e){t.classList.add(e)}));else t.className.match(e)||(t.className+=" ".concat(e))}}function f(t,e){var n="";return"currentStyle"in t?n=t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(t,null).getPropertyValue(e)),n&&n.toLowerCase?n.toLowerCase():n}function d(t){p(t,"introjs-showElement");var e=f(t,"position");"absolute"!==e&&"relative"!==e&&"sticky"!==e&&"fixed"!==e&&p(t,"introjs-relativePosition")}function m(t){if(this._options.scrollToElement){var e=function(t){var e=window.getComputedStyle(t),n="absolute"===e.position,r=/(auto|scroll)/;if("fixed"===e.position)return document.body;for(var i=t;i=i.parentElement;)if(e=window.getComputedStyle(i),(!n||"static"!==e.position)&&r.test(e.overflow+e.overflowY+e.overflowX))return i;return document.body}(t);e!==document.body&&(e.scrollTop=t.offsetTop-e.offsetTop)}}function b(){if(void 0!==window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}function v(t,e,n){var r;if("off"!==t&&(this._options.scrollToElement&&(r="tooltip"===t?n.getBoundingClientRect():e.getBoundingClientRect(),!function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom+80<=window.innerHeight&&e.right<=window.innerWidth}(e)))){var i=b().height;r.bottom-(r.bottom-r.top)<0||e.clientHeight>i?window.scrollBy(0,r.top-(i/2-r.height/2)-this._options.scrollPadding):window.scrollBy(0,r.top-(i/2-r.height/2)+this._options.scrollPadding)}}function y(t){t.setAttribute("role","button"),t.tabIndex=0}function g(t){var e=t.parentElement;return!(!e||"HTML"===e.nodeName)&&("fixed"===f(t,"position")||g(e))}function w(t,e){var n=document.body,r=document.documentElement,i=window.pageYOffset||r.scrollTop||n.scrollTop,o=window.pageXOffset||r.scrollLeft||n.scrollLeft;e=e||n;var a=t.getBoundingClientRect(),s=e.getBoundingClientRect(),l=f(e,"position"),c={width:a.width,height:a.height};return"body"!==e.tagName.toLowerCase()&&"relative"===l||"sticky"===l?Object.assign(c,{top:a.top-s.top,left:a.left-s.left}):g(t)?Object.assign(c,{top:a.top,left:a.left}):Object.assign(c,{top:a.top+i,left:a.left+o})}function _(t,e){if(t instanceof SVGElement){var n=t.getAttribute("class")||"";t.setAttribute("class",n.replace(e,"").replace(/^\s+|\s+$/g,""))}else t.className=t.className.replace(e,"").replace(/^\s+|\s+$/g,"")}function x(t,e){var n="";if(t.style.cssText&&(n+=t.style.cssText),"string"==typeof e)n+=e;else for(var r in e)n+="".concat(r,":").concat(e[r],";");t.style.cssText=n}function k(t){if(t){if(!this._introItems[this._currentStep])return;var e=this._introItems[this._currentStep],n=w(e.element,this._targetElement),r=this._options.helperElementPadding;g(e.element)?p(t,"introjs-fixedTooltip"):_(t,"introjs-fixedTooltip"),"floating"===e.position&&(r=0),x(t,{width:"".concat(n.width+r,"px"),height:"".concat(n.height+r,"px"),top:"".concat(n.top-r/2,"px"),left:"".concat(n.left-r/2,"px")})}}function C(t,e,n,r,i){return t.left+e+n.width>r.width?(i.style.left="".concat(r.width-n.width-t.left,"px"),!1):(i.style.left="".concat(e,"px"),!0)}function S(t,e,n,r){return t.left+t.width-e-n.width<0?(r.style.left="".concat(-t.left,"px"),!1):(r.style.right="".concat(e,"px"),!0)}function j(t,e){t.includes(e)&&t.splice(t.indexOf(e),1)}function A(t,e,n){var r=this._options.positionPrecedence.slice(),i=b(),o=w(e).height+10,a=w(e).width+20,s=t.getBoundingClientRect(),l="floating";s.bottom+o>i.height&&j(r,"bottom"),s.top-o<0&&j(r,"top"),s.right+a>i.width&&j(r,"right"),s.left-a<0&&j(r,"left");var c,u,h=-1!==(u=(c=n||"").indexOf("-"))?c.substr(u):"";return n&&(n=n.split("-")[0]),r.length&&(l=r.includes(n)?n:r[0]),["top","bottom"].includes(l)&&(l+=function(t,e,n,r){var i=e/2,o=Math.min(n,window.screen.width),a=["-left-aligned","-middle-aligned","-right-aligned"];return o-t<e&&j(a,"-left-aligned"),(t<i||o-t<i)&&j(a,"-middle-aligned"),t<e&&j(a,"-right-aligned"),a.length?a.includes(r)?r:a[0]:"-middle-aligned"}(s.left,a,i.width,h)),l}function E(t,e,n,r){var i,o,a,s,l,c="";if(r=r||!1,e.style.top=null,e.style.right=null,e.style.bottom=null,e.style.left=null,e.style.marginLeft=null,e.style.marginTop=null,n.style.display="inherit",this._introItems[this._currentStep]){c="string"==typeof(i=this._introItems[this._currentStep]).tooltipClass?i.tooltipClass:this._options.tooltipClass,e.className=["introjs-tooltip",c].filter(Boolean).join(" "),e.setAttribute("role","dialog"),"floating"!==(l=this._introItems[this._currentStep].position)&&this._options.autoPosition&&(l=A.call(this,t,e,l)),a=w(t),o=w(e),s=b(),p(e,"introjs-".concat(l));var u=a.width/2-o.width/2;switch(l){case"top-right-aligned":n.className="introjs-arrow bottom-right";var h=0;S(a,h,o,e),e.style.bottom="".concat(a.height+20,"px");break;case"top-middle-aligned":n.className="introjs-arrow bottom-middle",r&&(u+=5),S(a,u,o,e)&&(e.style.right=null,C(a,u,o,s,e)),e.style.bottom="".concat(a.height+20,"px");break;case"top-left-aligned":case"top":n.className="introjs-arrow bottom",C(a,r?0:15,o,s,e),e.style.bottom="".concat(a.height+20,"px");break;case"right":e.style.left="".concat(a.width+20,"px"),a.top+o.height>s.height?(n.className="introjs-arrow left-bottom",e.style.top="-".concat(o.height-a.height-20,"px")):n.className="introjs-arrow left";break;case"left":r||!0!==this._options.showStepNumbers||(e.style.top="15px"),a.top+o.height>s.height?(e.style.top="-".concat(o.height-a.height-20,"px"),n.className="introjs-arrow right-bottom"):n.className="introjs-arrow right",e.style.right="".concat(a.width+20,"px");break;case"floating":n.style.display="none",e.style.left="50%",e.style.top="50%",e.style.marginLeft="-".concat(o.width/2,"px"),e.style.marginTop="-".concat(o.height/2,"px");break;case"bottom-right-aligned":n.className="introjs-arrow top-right",S(a,h=0,o,e),e.style.top="".concat(a.height+20,"px");break;case"bottom-middle-aligned":n.className="introjs-arrow top-middle",r&&(u+=5),S(a,u,o,e)&&(e.style.right=null,C(a,u,o,s,e)),e.style.top="".concat(a.height+20,"px");break;default:n.className="introjs-arrow top",C(a,0,o,s,e),e.style.top="".concat(a.height+20,"px")}}}function N(){u(Array.from(document.querySelectorAll(".introjs-showElement")),(function(t){_(t,/introjs-[a-zA-Z]+/g)}))}function L(t,e){var n=document.createElement(t);e=e||{};var r=/^(?:role|data-|aria-)/;for(var i in e){var o=e[i];"style"===i?x(n,o):i.match(r)?n.setAttribute(i,o):n[i]=o}return n}function T(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var r=e.style.opacity||"1";x(e,{opacity:"0"}),window.setTimeout((function(){x(e,{opacity:r})}),10)}t.appendChild(e)}function I(){return parseInt(this._currentStep+1,10)/this._introItems.length*100}function P(){var t=document.querySelector(".introjs-disableInteraction");null===t&&(t=L("div",{className:"introjs-disableInteraction"}),this._targetElement.appendChild(t)),k.call(this,t)}function q(t){var e=this,n=L("div",{className:"introjs-bullets"});!1===this._options.showBullets&&(n.style.display="none");var r=L("ul");r.setAttribute("role","tablist");var i=function(){e.goToStep(this.getAttribute("data-step-number"))};return u(this._introItems,(function(e,n){var o=e.step,a=L("li"),s=L("a");a.setAttribute("role","presentation"),s.setAttribute("role","tab"),s.onclick=i,n===t.step-1&&(s.className="active"),y(s),s.innerHTML="&nbsp;",s.setAttribute("data-step-number",o),a.appendChild(s),r.appendChild(a)})),n.appendChild(r),n}function O(t){if(this._options.showBullets){var e=document.querySelector(".introjs-bullets");e&&e.parentNode.replaceChild(q.call(this,t),e)}}function B(t,e){this._options.showBullets&&(t.querySelector(".introjs-bullets li > a.active").className="",t.querySelector('.introjs-bullets li > a[data-step-number="'.concat(e.step,'"]')).className="active")}function H(){var t=L("div");t.className="introjs-progress",!1===this._options.showProgress&&(t.style.display="none");var e=L("div",{className:"introjs-progressbar"});return this._options.progressBarAdditionalClass&&(e.className+=" "+this._options.progressBarAdditionalClass),e.setAttribute("role","progress"),e.setAttribute("aria-valuemin","0"),e.setAttribute("aria-valuemax","100"),e.setAttribute("aria-valuenow",I.call(this)),e.style.cssText="width:".concat(I.call(this),"%;"),t.appendChild(e),t}function R(t){t.querySelector(".introjs-progress .introjs-progressbar").style.cssText="width:".concat(I.call(this),"%;"),t.querySelector(".introjs-progress .introjs-progressbar").setAttribute("aria-valuenow",I.call(this))}function M(t){return F.apply(this,arguments)}function F(){return(F=r(t().mark((function e(n){var i,o,a,s,l,c,u,h,f,b,g,w,_,C,S,j,A,I,O,M,F,D,G,V,z,Y=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._introChangeCallback){e.next=3;break}return e.next=3,this._introChangeCallback.call(this,n.element);case 3:if(i=this,o=document.querySelector(".introjs-helperLayer"),a=document.querySelector(".introjs-tooltipReferenceLayer"),s="introjs-helperLayer","string"==typeof n.highlightClass&&(s+=" ".concat(n.highlightClass)),"string"==typeof this._options.highlightClass&&(s+=" ".concat(this._options.highlightClass)),null!==o&&null!==a?(h=a.querySelector(".introjs-helperNumberLayer"),f=a.querySelector(".introjs-tooltiptext"),b=a.querySelector(".introjs-tooltip-title"),g=a.querySelector(".introjs-arrow"),w=a.querySelector(".introjs-tooltip"),u=a.querySelector(".introjs-skipbutton"),c=a.querySelector(".introjs-prevbutton"),l=a.querySelector(".introjs-nextbutton"),o.className=s,w.style.opacity="0",w.style.display="none",m.call(i,n.element),k.call(i,o),k.call(i,a),N(),i._lastShowElementTimer&&window.clearTimeout(i._lastShowElementTimer),i._lastShowElementTimer=window.setTimeout((function(){null!==h&&(h.innerHTML="".concat(n.step," ").concat(Y._options.stepNumbersOfLabel," ").concat(Y._introItems.length)),f.innerHTML=n.intro,b.innerHTML=n.title,w.style.display="block",E.call(i,n.element,w,g),B.call(i,a,n),R.call(i,a),w.style.opacity="1",(null!=l&&/introjs-donebutton/gi.test(l.className)||null!=l)&&l.focus(),v.call(i,n.scrollTo,n.element,f)}),350)):(_=L("div",{className:s}),C=L("div",{className:"introjs-tooltipReferenceLayer"}),S=L("div",{className:"introjs-arrow"}),j=L("div",{className:"introjs-tooltip"}),A=L("div",{className:"introjs-tooltiptext"}),I=L("div",{className:"introjs-tooltip-header"}),O=L("h1",{className:"introjs-tooltip-title"}),M=L("div"),x(_,{"box-shadow":"0 0 1px 2px rgba(33, 33, 33, 0.8), rgba(33, 33, 33, ".concat(i._options.overlayOpacity.toString(),") 0 0 0 5000px")}),m.call(i,n.element),k.call(i,_),k.call(i,C),T(this._targetElement,_,!0),T(this._targetElement,C),A.innerHTML=n.intro,O.innerHTML=n.title,M.className="introjs-tooltipbuttons",!1===this._options.showButtons&&(M.style.display="none"),I.appendChild(O),j.appendChild(I),j.appendChild(A),this._options.dontShowAgain&&(F=L("div",{className:"introjs-dontShowAgain"}),(D=L("input",{type:"checkbox",id:"introjs-dontShowAgain",name:"introjs-dontShowAgain"})).onchange=function(t){Y.setDontShowAgain(t.target.checked)},(G=L("label",{htmlFor:"introjs-dontShowAgain"})).innerText=this._options.dontShowAgainLabel,F.appendChild(D),F.appendChild(G),j.appendChild(F)),j.appendChild(q.call(this,n)),j.appendChild(H.call(this)),V=L("div"),!0===this._options.showStepNumbers&&(V.className="introjs-helperNumberLayer",V.innerHTML="".concat(n.step," ").concat(this._options.stepNumbersOfLabel," ").concat(this._introItems.length),j.appendChild(V)),j.appendChild(S),C.appendChild(j),(l=L("a")).onclick=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i._introItems.length-1===i._currentStep){t.next=5;break}return t.next=3,W.call(i);case 3:t.next=11;break;case 5:if(!/introjs-donebutton/gi.test(l.className)){t.next=11;break}if("function"!=typeof i._introCompleteCallback){t.next=9;break}return t.next=9,i._introCompleteCallback.call(i,i._currentStep,"done");case 9:return t.next=11,xt.call(i,i._targetElement);case 11:case"end":return t.stop()}}),e)}))),y(l),l.innerHTML=this._options.nextLabel,(c=L("a")).onclick=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===i._currentStep){t.next=3;break}return t.next=3,$.call(i);case 3:case"end":return t.stop()}}),e)}))),y(c),c.innerHTML=this._options.prevLabel,y(u=L("a",{className:"introjs-skipbutton"})),u.innerHTML=this._options.skipLabel,u.onclick=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i._introItems.length-1!==i._currentStep||"function"!=typeof i._introCompleteCallback){t.next=3;break}return t.next=3,i._introCompleteCallback.call(i,i._currentStep,"skip");case 3:if("function"!=typeof i._introSkipCallback){t.next=6;break}return t.next=6,i._introSkipCallback.call(i);case 6:return t.next=8,xt.call(i,i._targetElement);case 8:case"end":return t.stop()}}),e)}))),I.appendChild(u),this._introItems.length>1&&M.appendChild(c),M.appendChild(l),j.appendChild(M),E.call(i,n.element,j,S),v.call(this,n.scrollTo,n.element,j)),(z=i._targetElement.querySelector(".introjs-disableInteraction"))&&z.parentNode.removeChild(z),n.disableInteraction&&P.call(i),0===this._currentStep&&this._introItems.length>1?(null!=l&&(l.className="".concat(this._options.buttonClass," introjs-nextbutton"),l.innerHTML=this._options.nextLabel),!0===this._options.hidePrev?(null!=c&&(c.className="".concat(this._options.buttonClass," introjs-prevbutton introjs-hidden")),null!=l&&p(l,"introjs-fullbutton")):null!=c&&(c.className="".concat(this._options.buttonClass," introjs-prevbutton introjs-disabled"))):this._introItems.length-1===this._currentStep||1===this._introItems.length?(null!=c&&(c.className="".concat(this._options.buttonClass," introjs-prevbutton")),!0===this._options.hideNext?(null!=l&&(l.className="".concat(this._options.buttonClass," introjs-nextbutton introjs-hidden")),null!=c&&p(c,"introjs-fullbutton")):null!=l&&(!0===this._options.nextToDone?(l.innerHTML=this._options.doneLabel,p(l,"".concat(this._options.buttonClass," introjs-nextbutton introjs-donebutton"))):l.className="".concat(this._options.buttonClass," introjs-nextbutton introjs-disabled"))):(null!=c&&(c.className="".concat(this._options.buttonClass," introjs-prevbutton")),null!=l&&(l.className="".concat(this._options.buttonClass," introjs-nextbutton"),l.innerHTML=this._options.nextLabel)),null!=c&&c.setAttribute("role","button"),null!=l&&l.setAttribute("role","button"),null!=u&&u.setAttribute("role","button"),null!=l&&l.focus(),d(n.element),void 0===this._introAfterChangeCallback){e.next=22;break}return e.next=22,this._introAfterChangeCallback.call(this,n.element);case 22:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function D(t){return G.apply(this,arguments)}function G(){return(G=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._currentStep=n-2,void 0===this._introItems){t.next=4;break}return t.next=4,W.call(this);case 4:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function V(t){return z.apply(this,arguments)}function z(){return(z=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._currentStepNumber=n,void 0===this._introItems){t.next=4;break}return t.next=4,W.call(this);case 4:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function W(){return Y.apply(this,arguments)}function Y(){return Y=r(t().mark((function e(){var n,r,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._direction="forward",void 0!==this._currentStepNumber&&u(this._introItems,(function(t,e){t.step===i._currentStepNumber&&(i._currentStep=e-1,i._currentStepNumber=void 0)})),void 0===this._currentStep?this._currentStep=0:++this._currentStep,n=this._introItems[this._currentStep],r=!0,void 0===this._introBeforeChangeCallback){t.next=9;break}return t.next=8,this._introBeforeChangeCallback.call(this,n&&n.element);case 8:r=t.sent;case 9:if(!1!==r){t.next=12;break}return--this._currentStep,t.abrupt("return",!1);case 12:if(!(this._introItems.length<=this._currentStep)){t.next=19;break}if("function"!=typeof this._introCompleteCallback){t.next=16;break}return t.next=16,this._introCompleteCallback.call(this,this._currentStep,"end");case 16:return t.next=18,xt.call(this,this._targetElement);case 18:return t.abrupt("return",!1);case 19:return t.next=21,M.call(this,n);case 21:return t.abrupt("return",!0);case 22:case"end":return t.stop()}}),e,this)}))),Y.apply(this,arguments)}function $(){return Q.apply(this,arguments)}function Q(){return Q=r(t().mark((function e(){var n,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._direction="backward",0!==this._currentStep){t.next=3;break}return t.abrupt("return",!1);case 3:if(--this._currentStep,n=this._introItems[this._currentStep],r=!0,void 0===this._introBeforeChangeCallback){t.next=10;break}return t.next=9,this._introBeforeChangeCallback.call(this,n&&n.element);case 9:r=t.sent;case 10:if(!1!==r){t.next=13;break}return++this._currentStep,t.abrupt("return",!1);case 13:return t.next=15,M.call(this,n);case 15:return t.abrupt("return",!0);case 16:case"end":return t.stop()}}),e,this)}))),Q.apply(this,arguments)}function U(){return this._currentStep}function X(t){return J.apply(this,arguments)}function J(){return(J=r(t().mark((function e(n){var r,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(r=void 0===n.code?n.which:n.code)&&(r=null===n.charCode?n.keyCode:n.charCode),"Escape"!==r&&27!==r||!0!==this._options.exitOnEsc){t.next=7;break}return t.next=5,xt.call(this,this._targetElement);case 5:t.next=39;break;case 7:if("ArrowLeft"!==r&&37!==r){t.next=12;break}return t.next=10,$.call(this);case 10:t.next=39;break;case 12:if("ArrowRight"!==r&&39!==r){t.next=17;break}return t.next=15,W.call(this);case 15:t.next=39;break;case 17:if("Enter"!==r&&"NumpadEnter"!==r&&13!==r){t.next=39;break}if(!(i=n.target||n.srcElement)||!i.className.match("introjs-prevbutton")){t.next=24;break}return t.next=22,$.call(this);case 22:t.next=38;break;case 24:if(!i||!i.className.match("introjs-skipbutton")){t.next=32;break}if(this._introItems.length-1!==this._currentStep||"function"!=typeof this._introCompleteCallback){t.next=28;break}return t.next=28,this._introCompleteCallback.call(this,this._currentStep,"skip");case 28:return t.next=30,xt.call(this,this._targetElement);case 30:t.next=38;break;case 32:if(!i||!i.getAttribute("data-step-number")){t.next=36;break}i.click(),t.next=38;break;case 36:return t.next=38,W.call(this);case 38:n.preventDefault?n.preventDefault():n.returnValue=!1;case 39:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function Z(t){if(null===t||"object"!==e(t)||"nodeType"in t)return t;var n={};for(var r in t)"jQuery"in window&&t[r]instanceof window.jQuery?n[r]=t[r]:n[r]=Z(t[r]);return n}function K(t,e){var n,r=this;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){t.apply(r,o)}),e)}}function tt(t){var e=document.querySelector(".introjs-hints");return e?Array.from(e.querySelectorAll(t)):[]}function et(t){return nt.apply(this,arguments)}function nt(){return(nt=r(t().mark((function e(n){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=tt('.introjs-hint[data-step="'.concat(n,'"]'))[0],dt.call(this),r&&p(r,"introjs-hidehint"),void 0===this._hintCloseCallback){t.next=6;break}return t.next=6,this._hintCloseCallback.call(this,n);case 6:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function rt(){var e=this;u(tt(".introjs-hint"),function(){var n=r(t().mark((function n(r){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et.call(e,r.getAttribute("data-step"));case 2:case"end":return t.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}function it(){return ot.apply(this,arguments)}function ot(){return(ot=r(t().mark((function e(){var n,r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=tt(".introjs-hint"))||!n.length){t.next=5;break}u(n,(function(t){at.call(r,t.getAttribute("data-step"))})),t.next=7;break;case 5:return t.next=7,mt.call(this,this._targetElement);case 7:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function at(t){var e=tt('.introjs-hint[data-step="'.concat(t,'"]'))[0];e&&_(e,/introjs-hidehint/g)}function st(){var t=this;u(tt(".introjs-hint"),(function(e){lt.call(t,e.getAttribute("data-step"))})),h.off(document,"click",dt,this,!1),h.off(window,"resize",vt,this,!0),this._hintsAutoRefreshFunction&&h.off(window,"scroll",this._hintsAutoRefreshFunction,this,!0)}function lt(t){var e=tt('.introjs-hint[data-step="'.concat(t,'"]'))[0];e&&e.parentNode.removeChild(e)}function ct(){return ut.apply(this,arguments)}function ut(){return(ut=r(t().mark((function e(){var n,r,i,o=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this,null===(r=document.querySelector(".introjs-hints"))&&(r=L("div",{className:"introjs-hints"})),i=function(t){return function(e){var r=e||window.event;r.stopPropagation&&r.stopPropagation(),null!==r.cancelBubble&&(r.cancelBubble=!0),pt.call(n,t)}},u(this._introItems,(function(t,e){if(!document.querySelector('.introjs-hint[data-step="'.concat(e,'"]'))){var n=L("a",{className:"introjs-hint"});y(n),n.onclick=i(e),t.hintAnimation||p(n,"introjs-hint-no-anim"),g(t.element)&&p(n,"introjs-fixedhint");var a=L("div",{className:"introjs-hint-dot"}),s=L("div",{className:"introjs-hint-pulse"});n.appendChild(a),n.appendChild(s),n.setAttribute("data-step",e.toString());var l=t.element;t.element=n,ht.call(o,t.hintPosition,n,l),r.appendChild(n)}})),document.body.appendChild(r),void 0===this._hintsAddedCallback){t.next=9;break}return t.next=9,this._hintsAddedCallback.call(this);case 9:this._options.hintAutoRefreshInterval>=0&&(this._hintsAutoRefreshFunction=K((function(){return vt.call(o)}),this._options.hintAutoRefreshInterval),h.on(window,"scroll",this._hintsAutoRefreshFunction,this,!0));case 10:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function ht(t,e,n){var r=w.call(this,n),i=20,o=20;switch(t){default:case"top-left":e.style.left="".concat(r.left,"px"),e.style.top="".concat(r.top,"px");break;case"top-right":e.style.left="".concat(r.left+r.width-i,"px"),e.style.top="".concat(r.top,"px");break;case"bottom-left":e.style.left="".concat(r.left,"px"),e.style.top="".concat(r.top+r.height-o,"px");break;case"bottom-right":e.style.left="".concat(r.left+r.width-i,"px"),e.style.top="".concat(r.top+r.height-o,"px");break;case"middle-left":e.style.left="".concat(r.left,"px"),e.style.top="".concat(r.top+(r.height-o)/2,"px");break;case"middle-right":e.style.left="".concat(r.left+r.width-i,"px"),e.style.top="".concat(r.top+(r.height-o)/2,"px");break;case"middle-middle":e.style.left="".concat(r.left+(r.width-i)/2,"px"),e.style.top="".concat(r.top+(r.height-o)/2,"px");break;case"bottom-middle":e.style.left="".concat(r.left+(r.width-i)/2,"px"),e.style.top="".concat(r.top+r.height-o,"px");break;case"top-middle":e.style.left="".concat(r.left+(r.width-i)/2,"px"),e.style.top="".concat(r.top,"px")}}function pt(t){return ft.apply(this,arguments)}function ft(){return(ft=r(t().mark((function e(n){var r,i,o,a,s,l,c,u,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=document.querySelector('.introjs-hint[data-step="'.concat(n,'"]')),i=this._introItems[n],void 0===this._hintClickCallback){t.next=5;break}return t.next=5,this._hintClickCallback.call(this,r,i,n);case 5:if(o=dt.call(this),parseInt(o,10)!==n){t.next=8;break}return t.abrupt("return");case 8:a=L("div",{className:"introjs-tooltip"}),s=L("div"),l=L("div"),c=L("div"),a.onclick=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},s.className="introjs-tooltiptext",(u=L("p")).innerHTML=i.hint,s.appendChild(u),this._options.hintShowButton&&((h=L("a")).className=this._options.buttonClass,h.setAttribute("role","button"),h.innerHTML=this._options.hintButtonLabel,h.onclick=et.bind(this,n),s.appendChild(h)),l.className="introjs-arrow",a.appendChild(l),a.appendChild(s),this._currentStep=r.getAttribute("data-step"),c.className="introjs-tooltipReferenceLayer introjs-hintReference",c.setAttribute("data-step",r.getAttribute("data-step")),k.call(this,c),c.appendChild(a),document.body.appendChild(c),E.call(this,r,a,l,!0);case 28:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function dt(){var t=document.querySelector(".introjs-hintReference");if(t){var e=t.getAttribute("data-step");return t.parentNode.removeChild(t),e}}function mt(t){return bt.apply(this,arguments)}function bt(){return(bt=r(t().mark((function e(n){var r,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._introItems=[],!this._options.hints){t.next=5;break}u(this._options.hints,(function(t){var e=Z(t);"string"==typeof e.element&&(e.element=document.querySelector(e.element)),e.hintPosition=e.hintPosition||i._options.hintPosition,e.hintAnimation=e.hintAnimation||i._options.hintAnimation,null!==e.element&&i._introItems.push(e)})),t.next=9;break;case 5:if((r=Array.from(n.querySelectorAll("*[data-hint]")))&&r.length){t.next=8;break}return t.abrupt("return",!1);case 8:u(r,(function(t){var e=t.getAttribute("data-hint-animation");e=e?"true"===e:i._options.hintAnimation,i._introItems.push({element:t,hint:t.getAttribute("data-hint"),hintPosition:t.getAttribute("data-hint-position")||i._options.hintPosition,hintAnimation:e,tooltipClass:t.getAttribute("data-tooltip-class"),position:t.getAttribute("data-position")||i._options.tooltipPosition})}));case 9:return t.next=11,ct.call(this);case 11:return h.on(document,"click",dt,this,!1),h.on(window,"resize",vt,this,!0),t.abrupt("return",!0);case 14:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function vt(){var t=this;u(this._introItems,(function(e){var n=e.targetElement,r=e.hintPosition,i=e.element;void 0!==n&&ht.call(t,r,i,n)}))}function yt(t){var e=this,n=Array.from(t.querySelectorAll("*[data-intro]")),r=[];if(this._options.steps)u(this._options.steps,(function(t){var n=Z(t);if(n.step=r.length+1,n.title=n.title||"","string"==typeof n.element&&(n.element=document.querySelector(n.element)),void 0===n.element||null===n.element){var i=document.querySelector(".introjsFloatingElement");null===i&&(i=L("div",{className:"introjsFloatingElement"}),document.body.appendChild(i)),n.element=i,n.position="floating"}n.position=n.position||e._options.tooltipPosition,n.scrollTo=n.scrollTo||e._options.scrollTo,void 0===n.disableInteraction&&(n.disableInteraction=e._options.disableInteraction),null!==n.element&&r.push(n)}));else{var i;if(n.length<1)return[];u(n,(function(t){if((!e._options.group||t.getAttribute("data-intro-group")===e._options.group)&&"none"!==t.style.display){var n=parseInt(t.getAttribute("data-step"),10);i=t.hasAttribute("data-disable-interaction")?!!t.getAttribute("data-disable-interaction"):e._options.disableInteraction,n>0&&(r[n-1]={element:t,title:t.getAttribute("data-title")||"",intro:t.getAttribute("data-intro"),step:parseInt(t.getAttribute("data-step"),10),tooltipClass:t.getAttribute("data-tooltip-class"),highlightClass:t.getAttribute("data-highlight-class"),position:t.getAttribute("data-position")||e._options.tooltipPosition,scrollTo:t.getAttribute("data-scroll-to")||e._options.scrollTo,disableInteraction:i})}}));var o=0;u(n,(function(t){if((!e._options.group||t.getAttribute("data-intro-group")===e._options.group)&&null===t.getAttribute("data-step")){for(;void 0!==r[o];)o++;i=t.hasAttribute("data-disable-interaction")?!!t.getAttribute("data-disable-interaction"):e._options.disableInteraction,r[o]={element:t,title:t.getAttribute("data-title")||"",intro:t.getAttribute("data-intro"),step:o+1,tooltipClass:t.getAttribute("data-tooltip-class"),highlightClass:t.getAttribute("data-highlight-class"),position:t.getAttribute("data-position")||e._options.tooltipPosition,scrollTo:t.getAttribute("data-scroll-to")||e._options.scrollTo,disableInteraction:i}}}))}for(var a=[],s=0;s<r.length;s++)r[s]&&a.push(r[s]);return(r=a).sort((function(t,e){return t.step-e.step})),r}function gt(t){var e=document.querySelector(".introjs-tooltipReferenceLayer"),n=document.querySelector(".introjs-helperLayer"),r=document.querySelector(".introjs-disableInteraction");if(k.call(this,n),k.call(this,e),k.call(this,r),t&&(this._introItems=yt.call(this,this._targetElement),O.call(this,this._introItems[this._currentStep]),R.call(this,e)),void 0!==this._currentStep&&null!==this._currentStep){var i=document.querySelector(".introjs-arrow"),o=document.querySelector(".introjs-tooltip");o&&i&&E.call(this,this._introItems[this._currentStep].element,o,i)}return vt.call(this),this}function wt(){gt.call(this)}function _t(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&t.parentElement){var n=t.parentElement;e?(x(t,{opacity:"0"}),window.setTimeout((function(){try{n.removeChild(t)}catch(t){}}),500)):n.removeChild(t)}}function xt(t,e){return kt.apply(this,arguments)}function kt(){return(kt=r(t().mark((function e(n,r){var i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!0,void 0===this._introBeforeExitCallback){t.next=5;break}return t.next=4,this._introBeforeExitCallback.call(this);case 4:i=t.sent;case 5:if(r||!1!==i){t.next=7;break}return t.abrupt("return");case 7:if((o=Array.from(n.querySelectorAll(".introjs-overlay")))&&o.length&&u(o,(function(t){return _t(t)})),_t(n.querySelector(".introjs-helperLayer"),!0),_t(n.querySelector(".introjs-tooltipReferenceLayer")),_t(n.querySelector(".introjs-disableInteraction")),_t(document.querySelector(".introjsFloatingElement")),N(),h.off(window,"keydown",X,this,!0),h.off(window,"resize",wt,this,!0),void 0===this._introExitCallback){t.next=23;break}return t.next=23,this._introExitCallback.call(this);case 23:this._currentStep=void 0;case 24:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function Ct(e){var n=this,i=L("div",{className:"introjs-overlay"});return x(i,{top:0,bottom:0,left:0,right:0,position:"fixed"}),e.appendChild(i),!0===this._options.exitOnOverlayClick&&(x(i,{cursor:"pointer"}),i.onclick=r(t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xt.call(n,e);case 2:case"end":return t.stop()}}),r)})))),!0}function St(t){return jt.apply(this,arguments)}function jt(){return(jt=r(t().mark((function e(n){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isActive()){t.next=2;break}return t.abrupt("return",!1);case 2:if(void 0===this._introStartCallback){t.next=5;break}return t.next=5,this._introStartCallback.call(this,n);case 5:if(0!==(r=yt.call(this,n)).length){t.next=8;break}return t.abrupt("return",!1);case 8:if(this._introItems=r,!Ct.call(this,n)){t.next=14;break}return t.next=12,W.call(this);case 12:this._options.keyboardNavigation&&h.on(window,"keydown",X,this,!0),h.on(window,"resize",wt,this,!0);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),e,this)})))).apply(this,arguments)}function At(t,e,n){var r,i=(o(r={},t,e),o(r,"path","/"),o(r,"expires",void 0),r);if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i.expires=a.toUTCString()}var s=[];for(var l in i)s.push("".concat(l,"=").concat(i[l]));return document.cookie=s.join("; "),Et(t)}function Et(t){return(e={},document.cookie.split(";").forEach((function(t){var n=a(t.split("="),2),r=n[0],i=n[1];e[r.trim()]=i})),e)[t];var e}var Nt="true";function Lt(t){t?At(this._options.dontShowAgainCookie,Nt,this._options.dontShowAgainCookieDays):At(this._options.dontShowAgainCookie,"",-1)}function Tt(){var t=Et(this._options.dontShowAgainCookie);return t&&t===Nt}var It=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"_targetElement",void 0),o(this,"_introItems",[]),o(this,"_options",void 0),o(this,"_introBeforeChangeCallback",void 0),o(this,"_introChangeCallback",void 0),o(this,"_introAfterChangeCallback",void 0),o(this,"_introCompleteCallback",void 0),o(this,"_hintsAddedCallback",void 0),o(this,"_hintClickCallback",void 0),o(this,"_hintCloseCallback",void 0),o(this,"_introStartCallback",void 0),o(this,"_introExitCallback",void 0),o(this,"_introSkipCallback",void 0),o(this,"_introBeforeExitCallback",void 0),this._targetElement=t,this._options={isActive:!0,nextLabel:"Next",prevLabel:"Back",skipLabel:"",doneLabel:"Done",hidePrev:!1,hideNext:!1,nextToDone:!0,tooltipPosition:"bottom",tooltipClass:"",group:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!1,stepNumbersOfLabel:"of",keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,scrollTo:"element",scrollPadding:30,overlayOpacity:.5,autoPosition:!0,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1,dontShowAgain:!1,dontShowAgainLabel:"Don't show this again",dontShowAgainCookie:"introjs-dontShowAgain",dontShowAgainCookieDays:365,helperElementPadding:10,hintPosition:"top-middle",hintButtonLabel:"Got it",hintShowButton:!0,hintAutoRefreshInterval:10,hintAnimation:!0,buttonClass:"introjs-button",progressBarAdditionalClass:!1}}var n,a,s,l,c,u,h,p,f,d,m,b,v;return n=e,a=[{key:"isActive",value:function(){return(!this._options.dontShowAgain||!Tt.call(this))&&this._options.isActive}},{key:"clone",value:function(){return new e(this._targetElement)}},{key:"setOption",value:function(t,e){return this._options[t]=e,this}},{key:"setOptions",value:function(t){return this._options=function(t,e){var n,r={};for(n in t)r[n]=t[n];for(n in e)r[n]=e[n];return r}(this._options,t),this}},{key:"start",value:(v=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,St.call(this,this._targetElement);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"goToStep",value:(b=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.call(this,n);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(t){return b.apply(this,arguments)})},{key:"addStep",value:function(t){return this._options.steps||(this._options.steps=[]),this._options.steps.push(t),this}},{key:"addSteps",value:function(t){if(!t.length)return this;for(var e=0;e<t.length;e++)this.addStep(t[e]);return this}},{key:"goToStepNumber",value:(m=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V.call(this,n);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(t){return m.apply(this,arguments)})},{key:"nextStep",value:(d=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.call(this);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"previousStep",value:(f=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$.call(this);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"currentStep",value:function(){return U.call(this)}},{key:"exit",value:(p=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xt.call(this,this._targetElement,n);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(t){return p.apply(this,arguments)})},{key:"refresh",value:function(t){return gt.call(this,t),this}},{key:"setDontShowAgain",value:function(t){return Lt.call(this,t),this}},{key:"onbeforechange",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=t,this}},{key:"onchange",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=t,this}},{key:"onafterchange",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=t,this}},{key:"oncomplete",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=t,this}},{key:"onhintsadded",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onhintsadded was not a function.");return this._hintsAddedCallback=t,this}},{key:"onhintclick",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onhintclick was not a function.");return this._hintClickCallback=t,this}},{key:"onhintclose",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onhintclose was not a function.");return this._hintCloseCallback=t,this}},{key:"onstart",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onstart was not a function.");return this._introStartCallback=t,this}},{key:"onexit",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=t,this}},{key:"onskip",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onskip was not a function.");return this._introSkipCallback=t,this}},{key:"onbeforeexit",value:function(t){if("function"!=typeof t)throw new Error("Provided callback for onbeforeexit was not a function.");return this._introBeforeExitCallback=t,this}},{key:"addHints",value:function(){var e=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,mt.call(this,this._targetElement);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hideHint",value:(h=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et.call(this,n);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(t){return h.apply(this,arguments)})},{key:"hideHints",value:(u=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt.call(this);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"showHint",value:function(t){return at.call(this,t),this}},{key:"showHints",value:(c=r(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,it.call(this);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"removeHints",value:function(){return st.call(this),this}},{key:"removeHint",value:function(t){return lt.call(this,t),this}},{key:"showHintDialog",value:(l=r(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,pt.call(this,n);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),e,this)}))),function(t){return l.apply(this,arguments)})}],a&&i(n.prototype,a),s&&i(n,s),Object.defineProperty(n,"prototype",{writable:!1}),e}(),Pt=function t(n){var r;if("object"===e(n))r=new It(n);else if("string"==typeof n){var i=document.querySelector(n);if(!i)throw new Error("There is no element with given selector.");r=new It(i)}else r=new It(document.body);return t.instances[c(r,"introjs-instance")]=r,r};return Pt.version="7.0.1",Pt.instances={},Pt}));let onboardingUtilsModule=(function(){let book_demo_modal_selector='#book-demo-modal';let ebook_offer_modal_selector='#ebook-offer-modal';let spinner_book_demo_modal_selector=book_demo_modal_selector+' .spinner';let spinner_ebook_offer_modal_selector=ebook_offer_modal_selector+' .spinner';let already_open_book_demo_modal=false;let already_open_ebook_offer_modal=false;let max_seconds_to_wait_for_next_step=60;let seconds_to_check_if_next_step=0.5;let store_book_demo_url='/register-book-demo/';let store_ebook_offer_url='/resource/50-startups-to-watch-2023/';let book_demo_url='https://booking.linknovate.com/team/demo';function is_preview_loading_results(){return $("#preview_search_loader").is(":visible");}
function _disable_intro_button(element){element.addClass('introjs-disabled');element.addClass('introjs-waiting');element.get(0).onclick=null;}
function _enable_intro_button(element,original_onclick){element.removeClass('introjs-disabled');element.removeClass('introjs-waiting');element.get(0).onclick=original_onclick;}
function check_if_next_step_ready(){let next_button_e=$('.introjs-nextbutton');let prev_button_e=$('.introjs-prevbutton');var original_onclick=next_button_e.get(0).onclick;var prev_original_onclick=prev_button_e.get(0).onclick;var seconds_waiting=0;if(is_preview_loading_results()){_disable_intro_button(next_button_e);_disable_intro_button(prev_button_e);var intervalId=null;function check_element_visible(){var time_waiting_exceeded=seconds_waiting>=max_seconds_to_wait_for_next_step;if(time_waiting_exceeded){window.location.reload();}else{if(is_preview_loading_results()){seconds_waiting+=seconds_to_check_if_next_step;}else{_enable_intro_button(next_button_e,original_onclick);_enable_intro_button(prev_button_e,prev_original_onclick);clearInterval(intervalId);}}}
intervalId=setInterval(check_element_visible,seconds_to_check_if_next_step*1000);}}
function open_book_demo_modal(is_doc,check_if_open=false){let eventSign=''
if(is_doc){eventSign='open_book_demo_modal_from_doc'}else{eventSign='open_book_demo_modal'}
if(!check_if_open||!already_open_book_demo_modal){let modal_elem=$(book_demo_modal_selector)[0];ga_eventa('click',eventSign);bootstrap.Modal.getOrCreateInstance(modal_elem).show();already_open_book_demo_modal=true;}}
function open_ebook_offer_modal(){if(!already_open_ebook_offer_modal){close_all_active_modals();let modal_elem=$(ebook_offer_modal_selector)[0];let modal=bootstrap.Modal.getOrCreateInstance(modal_elem);modal.show();already_open_ebook_offer_modal=true;}}
function trigger_auto_open_book_demo_modal(seconds_time){setTimeout(function(){open_book_demo_modal(true);},seconds_time);}
function hint_dynamic_element(step,element,position){step._introItems[step._currentStep].element=element;step._introItems[step._currentStep].position=position;}
function is_step_back(_currentStep,_previous_step){return _currentStep<_previous_step}
function add_align_element_to_top(element){$(element).addClass('align-top');}
function remove_align_element_to_top(element){$(element).removeClass('align-top');}
function redirect_to_url_query(onboarding_token=undefined,use_case_industry=undefined){let query_parsed=build_complex_query()
let full_page_url=query_parsed['pageurl'];if(onboarding_token){full_page_url=full_page_url+"&onboarding-access="+onboarding_token;}
if(use_case_industry){full_page_url=full_page_url+"&industry="+use_case_industry;}
location.href=full_page_url;}
function highlight_extra_element(element){$(element).addClass('highlight-onboarding');}
function remove_highlight_extra_element(element){$(element).removeClass('highlight-onboarding');}
function _skip_exception(cb){try{cb();}catch(e){}}
function launch_request_demo_modal_on_every_click(is_doc,list_of_selectors,list_excluded_selectors=[]){let excluding_elements_concatenated='';$.each(list_excluded_selectors,function(index,element){excluding_elements_concatenated+=':not('+element+')';})
$.each(list_of_selectors,function(index,element){let elements_to_attach_event=element+excluding_elements_concatenated;let $elements_to_attach_event=$(elements_to_attach_event);$elements_to_attach_event.removeAttr("href");$elements_to_attach_event.removeAttr("onclick");$elements_to_attach_event.removeAttr("data-bs-target");_skip_exception(function(){d3.selectAll($elements_to_attach_event).on('click',null);})
_skip_exception(function(){foamtree.set("onGroupSelectionChanged",null);})
$elements_to_attach_event.css('cursor','pointer')
$elements_to_attach_event.unbind('click');$elements_to_attach_event.click(function(){open_book_demo_modal(is_doc);});})}
function _save_onboarding_info(endpoint,callData,cb){$.ajax({url:endpoint,type:"POST",headers:{"X-CSRFToken":getCookie('csrftoken'),"Content-Type":"application/json"},data:JSON.stringify(callData)}).always(()=>{if(typeof cb==='function')cb();})}
function _show_spinner(spinner){$(spinner).removeClass('hidden');}
function _remove_spinner(spinner){$(spinner).addClass('hidden');}
function _show_feedback_msg(modal){let $feedback_msg_wrapper=$(modal).find('.feedback-msg-wrapper');let $form=$feedback_msg_wrapper.find('form');let $feedback_msg=$feedback_msg_wrapper.find('.feedback-msg');$form.hide();$feedback_msg.show();}
function _go_to_book_a_demo(){location.href=book_demo_url;}
function store_book_demo_info(element){let $element=$(element);let full_name=$element.find('input#full-name').val();let business_email=$element.find('input#business-email').val();_show_spinner(spinner_book_demo_modal_selector);let callData={"name":full_name,"email":business_email}
_save_onboarding_info(store_book_demo_url,callData,function(){_go_to_book_a_demo();})
return false;}
function store_ebook_offer_info(element){let $element=$(element);let first_name=$element.find('input#first-name').val();let organization=$element.find('input#organization').val();let business_email=$element.find('input#business-email').val();_show_spinner(spinner_ebook_offer_modal_selector);let callData={"rfirstname":first_name,"rusername":business_email,"ruserinfow":organization}
_save_onboarding_info(store_ebook_offer_url,callData,function(){_show_feedback_msg(ebook_offer_modal_selector);_remove_spinner(spinner_ebook_offer_modal_selector);})
return false;}
return{is_step_back:is_step_back,hint_dynamic_element:hint_dynamic_element,redirect_to_url_query:redirect_to_url_query,highlight_extra_element:highlight_extra_element,add_align_element_to_top:add_align_element_to_top,remove_align_element_to_top:remove_align_element_to_top,remove_highlight_extra_element:remove_highlight_extra_element,launch_request_demo_modal_on_every_click:launch_request_demo_modal_on_every_click,check_if_next_step_ready:check_if_next_step_ready,open_book_demo_modal:open_book_demo_modal,open_ebook_offer_modal:open_ebook_offer_modal,trigger_auto_open_book_demo_modal:trigger_auto_open_book_demo_modal,store_book_demo_info:store_book_demo_info,store_ebook_offer_info:store_ebook_offer_info}})();;let onboardingInnoScoutModule=(function(){let _terms_filter_selector='#search-term-filter-id';let _foam_tree_selector='#foam-tree-filter-id';let _references_filter_selector='#references-filter';let _all_tabs_selector='.search_tabs_buttons_wrapper ul.nav-only-tabs';let _link_analytics_tab_selector='a.navbar-link.analytics-tab-ut';let _generate_report_button_selector='#generate_report';let _intro_element;let _previous_step=0;let _disableInteraction=true;let _showProgress=true;let _showBullets=false;let _showStepNumbers=false;let _exitOnOverlayClick=false;let _keyboardNavigation=false;let _reportURLToDownload=undefined;let _onboarding_utils=onboardingUtilsModule;function initSettings(disableInteraction,showProgress,showBullets,showStepNumbers,exitOnOverlayClick,keyboardNavigation,reportURLToDownload){_disableInteraction=disableInteraction;_showProgress=showProgress;_showBullets=showBullets;_showStepNumbers=showStepNumbers;_exitOnOverlayClick=exitOnOverlayClick;_keyboardNavigation=keyboardNavigation;_reportURLToDownload=reportURLToDownload;}
function _notifyGeneratedReport(msg,type,delay=3000){$.bootstrapGrowl(msg,{type:type,offset:{from:'bottom',amount:20},width:'auto',align:'right',delay:delay});}
function _downloadOnboardingGeneratedReport(){window.open(_reportURLToDownload,'_blank');_notifyGeneratedReport('Your AI-powered report was downloaded.','my-info',0)}
function startUseCase(cb){ga_evental('action','start_onboarding_innoscout','onboarding');stopUseCase();_intro_element=introJs();_intro_element.setOptions({disableInteraction:_disableInteraction,showProgress:_disableInteraction,showBullets:_showBullets,showStepNumbers:_showStepNumbers,exitOnOverlayClick:_exitOnOverlayClick,keyboardNavigation:_keyboardNavigation,nextLabel:'Next',doneLabel:"Get insights",steps:[{intro:'In the left column: your search terms.</br>Below: a foam tree with clickable relevant phrases.'},{intro:"Scroll down to find filters such as source, organization type and location and others.",},{intro:"There are different tabs to find in-depth information.",},{intro:"Once you have your query ready, you can generate an AI-powered report in order to have the full landscape.",}]}).onbeforechange(function(targetElement){ga_evental('action','start_onboarding_innoscout_step'+this._currentStep,'onboarding');switch(this._currentStep)
{case 0:_onboarding_utils.hint_dynamic_element(this,document.querySelector(_terms_filter_selector),'right');_onboarding_utils.highlight_extra_element(_foam_tree_selector);break;case 1:_onboarding_utils.remove_highlight_extra_element(_foam_tree_selector);_onboarding_utils.hint_dynamic_element(this,document.querySelector(_references_filter_selector),'right');break;case 2:$(_link_analytics_tab_selector)[0].click();_onboarding_utils.hint_dynamic_element(this,document.querySelector(_all_tabs_selector),'bottom');break;case 3:_onboarding_utils.hint_dynamic_element(this,document.querySelector(_generate_report_button_selector),'bottom');_downloadOnboardingGeneratedReport()
break;default:break}
_previous_step=this._currentStep;}).oncomplete(function(){ga_evental('action','end_onboarding_innoscout','onboarding');cb();}).start();}
function stopUseCase(){_previous_step=0;if(_intro_element!==undefined)_intro_element.exit();}
return{initSettings:initSettings,startUseCase:startUseCase,stopUseCase:stopUseCase}})();;